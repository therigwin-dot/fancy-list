{"version":3,"file":"SetPublicPathPluginBase.js","sourceRoot":"","sources":["../src/SetPublicPathPluginBase.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAE3D,kFAAuE;AACvE,oEAAoF;AAIpF;;GAEG;AACH,MAAsB,uBAAuB;IAG3C,YAAmB,UAAkB;QACnC,IAAI,CAAC,WAAW,GAAG,UAAU,CAAC;IAChC,CAAC;IAEM,KAAK,CAAC,QAA0B;QACrC,IAAI,CAAC,2CAAgB,CAAC,UAAU,CAAC,QAAQ,CAAC,EAAE,CAAC;YAC3C,MAAM,eAAe,GAAiB,qCAAiB,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;YACtF,MAAM,IAAI,KAAK,CACb,OAAO,IAAI,CAAC,WAAW,CAAC,IAAI,qDAAqD;gBAC/E,GAAG,eAAe,CAAC,IAAI,yBAAyB,CACnD,CAAC;QACJ,CAAC;QAED,MAAM,WAAW,GAAmB,QAAQ,CAAC,OAAO,CAAC;QAErD,MAAM,8BAA8B,GAClC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC;QAErC,QAAQ,CAAC,KAAK,CAAC,eAAe,CAAC,GAAG,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC,WAAgC,EAAE,EAAE;YACxF,IAAI,8BAA8B,EAAE,CAAC;gBACnC,WAAW,CAAC,QAAQ,CAAC,IAAI,CACvB,IAAI,QAAQ,CAAC,OAAO,CAAC,YAAY,CAC/B,2EAA2E,IAAI,CAAC,WAAW,CAAC,IAAI,GAAG;oBACjG,6GAA6G;oBAC7G,kCAAkC,CACrC,CACF,CAAC;YACJ,CAAC;iBAAM,CAAC;gBACN,WAAW,CAAC,KAAK,CAAC,wBAAwB,CAAC,GAAG,CAAC,WAAW,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,SAAS,CAAC;oBAC9F,IAAI,EAAE,IAAI,CAAC,WAAW;oBACtB,QAAQ,EAAE,CAAC,GAAG,EAAE,EAAE;wBAChB,IAAI,GAAG,CAAC,IAAI,KAAK,eAAe,EAAE,CAAC;4BACjC,iDAAiD;4BACjD,OAAO;gCACL,GAAG,GAAG;gCACN,EAAE,EAAE,GAAG,EAAE;oCACP,UAAU;gCACZ,CAAC;6BACF,CAAC;wBACJ,CAAC;6BAAM,CAAC;4BACN,OAAO,GAAG,CAAC;wBACb,CAAC;oBACH,CAAC;iBACF,CAAC,CAAC;YACL,CAAC;YAED,IAAI,CAAC,iBAAiB,CAAC,WAAW,EAAE,WAAW,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;IACL,CAAC;CAGF;AAtDD,0DAsDC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport { VersionDetection } from '@rushstack/webpack-plugin-utilities';\nimport { PackageJsonLookup, type IPackageJson } from '@rushstack/node-core-library';\n\nimport type webpack from 'webpack';\n\n/**\n * @public\n */\nexport abstract class SetPublicPathPluginBase implements webpack.WebpackPluginInstance {\n  private readonly _pluginName: string;\n\n  public constructor(pluginName: string) {\n    this._pluginName = pluginName;\n  }\n\n  public apply(compiler: webpack.Compiler): void {\n    if (!VersionDetection.isWebpack5(compiler)) {\n      const thisPackageJson: IPackageJson = PackageJsonLookup.loadOwnPackageJson(__dirname);\n      throw new Error(\n        `The ${this.constructor.name} plugin requires Webpack 5. Use major version 4 of ` +\n          `${thisPackageJson.name} for Webpack 4 support.`\n      );\n    }\n\n    const thisWebpack: typeof webpack = compiler.webpack;\n\n    const initialOutputPublicPathSetting: typeof compiler.options.output.publicPath =\n      compiler.options.output.publicPath;\n\n    compiler.hooks.thisCompilation.tap(this._pluginName, (compilation: webpack.Compilation) => {\n      if (initialOutputPublicPathSetting) {\n        compilation.warnings.push(\n          new compiler.webpack.WebpackError(\n            `The \"output.publicPath\" option is set in the Webpack configuration. The ${this.constructor.name} ` +\n              'plugin may produce unexpected results. It is recommended that the \"output.publicPath\" configuration option ' +\n              'be unset when using this plugin.'\n          )\n        );\n      } else {\n        compilation.hooks.runtimeRequirementInTree.for(thisWebpack.RuntimeGlobals.publicPath).intercept({\n          name: this._pluginName,\n          register: (tap) => {\n            if (tap.name === 'RuntimePlugin') {\n              // Disable the default public path runtime plugin\n              return {\n                ...tap,\n                fn: () => {\n                  /* noop */\n                }\n              };\n            } else {\n              return tap;\n            }\n          }\n        });\n      }\n\n      this._applyCompilation(thisWebpack, compilation);\n    });\n  }\n\n  protected abstract _applyCompilation(thisWebpack: typeof webpack, compilation: webpack.Compilation): void;\n}\n"]}