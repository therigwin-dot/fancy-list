"use strict";
// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.
// See LICENSE in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
exports.TrueHashPlugin = void 0;
const trueHashes_1 = require("./trueHashes");
const PLUGIN_NAME = 'true-hash';
/**
 * @public
 */
class TrueHashPlugin {
    constructor(options = {}) {
        this._options = options;
    }
    apply(compiler) {
        compiler.hooks.thisCompilation.tap(PLUGIN_NAME, (compilation) => {
            const { webpack: thisWebpack } = compiler;
            const { hashFunction, stageOverride = thisWebpack.Compilation.PROCESS_ASSETS_STAGE_DEV_TOOLING - 1 } = this._options;
            const hashFn = hashFunction !== null && hashFunction !== void 0 ? hashFunction : (0, trueHashes_1.getHashFunction)({
                thisWebpack,
                compilation
            });
            compilation.hooks.processAssets.tap({
                name: PLUGIN_NAME,
                stage: stageOverride
            }, () => (0, trueHashes_1.updateAssetHashes)({ thisWebpack, compilation, hashFn }));
        });
    }
}
exports.TrueHashPlugin = TrueHashPlugin;
//# sourceMappingURL=TrueHashPlugin.js.map