{"version":3,"file":"asAsync.test.js","sourceRoot":"../src/","sources":["asAsync.test.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { asAsync } from './asAsync';\nimport * as renderer from 'react-test-renderer';\nimport type { ReactTestRenderer, ReactTestRendererJSON } from 'react-test-renderer';\n\nconst getChildren = (testRenderer: ReactTestRenderer) => (testRenderer.toJSON() as ReactTestRendererJSON)?.children;\n\ndescribe('asAsync', () => {\n  it('can async load exports', (done: () => undefined) => {\n    let _resolve: (result: React.ElementType<{}>) => void = () => undefined;\n    let _loadCalled = false;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const loadThingPromise = new Promise<any>((resolve: any) => {\n      _resolve = resolve;\n    });\n\n    const AsyncThing = asAsync({\n      load: () => {\n        _loadCalled = true;\n        return loadThingPromise;\n      },\n    });\n    const component = renderer.create(<AsyncThing />);\n\n    expect(_loadCalled).toBe(true);\n    expect(getChildren(component)).toBeUndefined();\n    expect(_resolve).toBeTruthy();\n\n    _resolve(() => <div>thing</div>);\n\n    process.nextTick(() => {\n      component.update(<AsyncThing />);\n\n      expect(getChildren(component)![0]).toEqual('thing');\n      _loadCalled = false;\n\n      // Test cached case.\n      renderer.create(<AsyncThing />);\n      expect(_loadCalled).toBe(false);\n      expect(getChildren(component)![0]).toEqual('thing');\n      done();\n    });\n  });\n\n  it('can async load with placeholder', (done: () => undefined) => {\n    let _resolve: (result: React.ElementType<{}>) => void = () => undefined;\n    let _loadCalled = false;\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const loadThingPromise = new Promise<any>((resolve: any) => {\n      _resolve = resolve;\n    });\n\n    const AsyncThing = asAsync({\n      load: () => {\n        _loadCalled = true;\n        return loadThingPromise;\n      },\n    });\n    const component = renderer.create(<AsyncThing asyncPlaceholder={() => <div>placeholder</div>} />);\n\n    expect(_loadCalled).toBe(true);\n    expect(getChildren(component)![0]).toEqual('placeholder');\n    expect(_resolve).toBeTruthy();\n\n    _resolve(() => <div>thing</div>);\n\n    process.nextTick(() => {\n      component.update(<AsyncThing asyncPlaceholder={() => <div>placeholder</div>} />);\n      expect(getChildren(component)![0]).toEqual('thing');\n      done();\n    });\n  });\n});\n"]}