{"version":3,"sources":["../src/components/Menu/useMenu.tsx"],"sourcesContent":["import * as React from 'react';\nimport {\n  resolvePositioningShorthand,\n  usePositioningMouseTarget,\n  usePositioning,\n  useSafeZoneArea,\n  type PositioningShorthandValue,\n} from '@fluentui/react-positioning';\nimport {\n  useControllableState,\n  useId,\n  useOnClickOutside,\n  useEventCallback,\n  useOnScrollOutside,\n  elementContains,\n  useTimeout,\n  useFirstMount,\n  useMergedRefs,\n} from '@fluentui/react-utilities';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport { useFocusFinders } from '@fluentui/react-tabster';\n\nimport { useMenuContext_unstable } from '../../contexts/menuContext';\nimport { MENU_SAFEZONE_TIMEOUT_EVENT, MENU_ENTER_EVENT, useOnMenuMouseEnter, useIsSubmenu } from '../../utils';\nimport { menuItemClassNames } from '../MenuItem/useMenuItemStyles.styles';\nimport type { MenuOpenChangeData, MenuOpenEvent, MenuProps, MenuState } from './Menu.types';\n\n// If it's not possible to position the submenu in smaller viewports, try\n// and fallback to this order of positions\nconst submenuFallbackPositions: PositioningShorthandValue[] = [\n  'after',\n  'after-bottom',\n  'before-top',\n  'before',\n  'before-bottom',\n  'above',\n];\n\n/**\n * Create the state required to render Menu.\n *\n * The returned state can be modified with hooks such as useMenuStyles,\n * before being passed to renderMenu_unstable.\n *\n * @param props - props from this instance of Menu\n */\nexport const useMenu_unstable = (props: MenuProps & { safeZone?: boolean | { timeout?: number } }): MenuState => {\n  const isSubmenu = useIsSubmenu();\n  const {\n    hoverDelay = 500,\n    inline = false,\n    hasCheckmarks = false,\n    hasIcons = false,\n    closeOnScroll = false,\n    openOnContext = false,\n    persistOnItemClick = false,\n    openOnHover = isSubmenu,\n    defaultCheckedValues,\n    mountNode = null,\n    safeZone,\n  } = props;\n\n  const { targetDocument } = useFluent();\n  const triggerId = useId('menu');\n  const [contextTarget, setContextTarget] = usePositioningMouseTarget();\n\n  const positioningOptions = {\n    position: isSubmenu ? 'after' : 'below',\n    align: isSubmenu ? 'top' : 'start',\n    target: props.openOnContext ? contextTarget : undefined,\n    fallbackPositions: isSubmenu ? submenuFallbackPositions : undefined,\n    ...resolvePositioningShorthand(props.positioning),\n  } as const;\n\n  const children = React.Children.toArray(props.children) as React.ReactElement[];\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (children.length === 0) {\n      // eslint-disable-next-line no-console\n      console.warn('Menu must contain at least one child');\n    }\n\n    if (children.length > 2) {\n      // eslint-disable-next-line no-console\n      console.warn('Menu must contain at most two children');\n    }\n  }\n\n  let menuTrigger: React.ReactElement | undefined = undefined;\n  let menuPopover: React.ReactElement | undefined = undefined;\n  if (children.length === 2) {\n    menuTrigger = children[0];\n    menuPopover = children[1];\n  } else if (children.length === 1) {\n    menuPopover = children[0];\n  }\n\n  const { targetRef, containerRef } = usePositioning(positioningOptions);\n\n  const enableSafeZone = safeZone && openOnHover;\n  const safeZoneDescriptorRef = React.useRef({\n    isInside: false,\n    mouseCoordinates: { x: 0, y: 0 },\n  });\n\n  const safeZoneHandle = useSafeZoneArea({\n    disabled: !enableSafeZone,\n    timeout: typeof safeZone === 'object' ? safeZone.timeout : 300,\n\n    onSafeZoneEnter: e => {\n      setOpen(e, { open: true, keyboard: false, type: 'menuSafeZoneMouseEnter', event: e });\n      safeZoneDescriptorRef.current.isInside = true;\n    },\n    onSafeZoneLeave: () => {\n      safeZoneDescriptorRef.current.isInside = false;\n    },\n    onSafeZoneMove: e => {\n      safeZoneDescriptorRef.current.mouseCoordinates = {\n        x: e.clientX,\n        y: e.clientY,\n      };\n    },\n    onSafeZoneTimeout: () => {\n      const event = new CustomEvent(MENU_SAFEZONE_TIMEOUT_EVENT);\n\n      setOpen(event, { open: false, keyboard: false, type: 'menuSafeZoneTimeout', event });\n\n      if (safeZoneDescriptorRef.current.isInside && targetDocument) {\n        const elementsInPoint = targetDocument.elementsFromPoint(\n          safeZoneDescriptorRef.current.mouseCoordinates.x,\n          safeZoneDescriptorRef.current.mouseCoordinates.y,\n        );\n        const menuItemEl = elementsInPoint.find(el => {\n          return el.classList.contains(menuItemClassNames.root);\n        }) as HTMLElement | null;\n\n        menuItemEl?.dispatchEvent(event);\n      }\n    },\n  });\n\n  const triggerRef = useMergedRefs(targetRef, safeZoneHandle.targetRef);\n  const menuPopoverRef = useMergedRefs(containerRef, safeZoneHandle.containerRef);\n\n  // TODO Better way to narrow types ?\n  const [open, setOpen] = useMenuOpenState({\n    hoverDelay,\n    isSubmenu,\n    setContextTarget,\n    closeOnScroll,\n    menuPopoverRef,\n    triggerRef,\n    open: props.open,\n    defaultOpen: props.defaultOpen,\n    onOpenChange: props.onOpenChange,\n    openOnContext,\n  });\n\n  const [checkedValues, onCheckedValueChange] = useMenuSelectableState({\n    checkedValues: props.checkedValues,\n    defaultCheckedValues,\n    onCheckedValueChange: props.onCheckedValueChange,\n  });\n\n  return {\n    inline,\n    hoverDelay,\n    triggerId,\n    isSubmenu,\n    openOnHover,\n    contextTarget,\n    setContextTarget,\n    hasCheckmarks,\n    hasIcons,\n    closeOnScroll,\n    menuTrigger,\n    menuPopover,\n    mountNode,\n    triggerRef,\n    menuPopoverRef,\n    components: {},\n    openOnContext,\n    open,\n    setOpen,\n    checkedValues,\n    onCheckedValueChange,\n    persistOnItemClick,\n    safeZone: safeZoneHandle.elementToRender,\n  };\n};\n\n/**\n * Adds appropriate state values and handlers for selectable items\n * i.e checkboxes and radios\n */\nconst useMenuSelectableState = (\n  props: Pick<MenuProps, 'checkedValues' | 'defaultCheckedValues' | 'onCheckedValueChange'>,\n) => {\n  const [checkedValues, setCheckedValues] = useControllableState({\n    state: props.checkedValues,\n    defaultState: props.defaultCheckedValues,\n    initialState: {},\n  });\n  const onCheckedValueChange: MenuState['onCheckedValueChange'] = useEventCallback((e, { name, checkedItems }) => {\n    props.onCheckedValueChange?.(e, { name, checkedItems });\n\n    setCheckedValues(currentValue => ({\n      ...currentValue,\n      [name]: checkedItems,\n    }));\n  });\n\n  return [checkedValues, onCheckedValueChange] as const;\n};\n\nconst useMenuOpenState = (\n  state: Pick<\n    MenuState,\n    | 'isSubmenu'\n    | 'menuPopoverRef'\n    | 'setContextTarget'\n    | 'triggerRef'\n    | 'openOnContext'\n    | 'closeOnScroll'\n    | 'hoverDelay'\n  > &\n    Pick<MenuProps, 'open' | 'defaultOpen' | 'onOpenChange'>,\n) => {\n  'use no memo';\n\n  const { targetDocument } = useFluent();\n  const parentSetOpen = useMenuContext_unstable(context => context.setOpen);\n  const onOpenChange: MenuProps['onOpenChange'] = useEventCallback((e, data) => state.onOpenChange?.(e, data));\n\n  const enteringTriggerRef = React.useRef(false);\n\n  const [open, setOpenState] = useControllableState({\n    state: state.open,\n    defaultState: state.defaultOpen,\n    initialState: false,\n  });\n\n  const trySetOpen = useEventCallback((e: MenuOpenEvent, data: MenuOpenChangeData) => {\n    const event = e instanceof CustomEvent && e.type === MENU_ENTER_EVENT ? e.detail.nativeEvent : e;\n    onOpenChange?.(event, { ...data });\n    if (data.open && e.type === 'contextmenu') {\n      state.setContextTarget(e as React.MouseEvent);\n    }\n\n    if (!data.open) {\n      state.setContextTarget(undefined);\n    }\n\n    if (data.bubble) {\n      parentSetOpen(e, { ...data });\n    }\n\n    setOpenState(data.open);\n  });\n\n  const [setOpenTimeout, clearOpenTimeout] = useTimeout();\n\n  const setOpen = useEventCallback((e: MenuOpenEvent, data: MenuOpenChangeData & { ignoreHoverDelay?: boolean }) => {\n    clearOpenTimeout();\n    if (!(e instanceof Event) && e.persist) {\n      // < React 17 still uses pooled synthetic events\n      e.persist();\n    }\n\n    const shouldUseDelay =\n      !data.ignoreHoverDelay &&\n      (e.type === 'mouseleave' || e.type === 'mouseover' || e.type === 'mousemove' || e.type === MENU_ENTER_EVENT);\n\n    if (shouldUseDelay) {\n      if (state.triggerRef.current?.contains(e.target as HTMLElement)) {\n        enteringTriggerRef.current = e.type === 'mouseover' || e.type === 'mousemove';\n      }\n\n      setOpenTimeout(() => trySetOpen(e, data), state.hoverDelay);\n    } else {\n      trySetOpen(e, data);\n    }\n  });\n\n  useOnClickOutside({\n    contains: elementContains,\n    disabled: !open,\n    element: targetDocument,\n    refs: [state.menuPopoverRef, !state.openOnContext && state.triggerRef].filter(\n      Boolean,\n    ) as React.MutableRefObject<HTMLElement>[],\n    callback: event => setOpen(event, { open: false, type: 'clickOutside', event }),\n  });\n\n  // only close on scroll for context, or when closeOnScroll is specified\n  const closeOnScroll = state.openOnContext || state.closeOnScroll;\n  useOnScrollOutside({\n    contains: elementContains,\n    element: targetDocument,\n    callback: event => setOpen(event, { open: false, type: 'scrollOutside', event }),\n    refs: [state.menuPopoverRef, !state.openOnContext && state.triggerRef].filter(\n      Boolean,\n    ) as React.MutableRefObject<HTMLElement>[],\n    disabled: !open || !closeOnScroll,\n  });\n\n  useOnMenuMouseEnter({\n    element: targetDocument,\n    callback: event => {\n      // When moving from a menu directly back to its trigger, this handler can close the menu\n      // Explicitly check a flag to see if this situation happens\n      if (!enteringTriggerRef.current) {\n        setOpen(event, { open: false, type: 'menuMouseEnter', event });\n      }\n    },\n    disabled: !open,\n    refs: [state.menuPopoverRef],\n  });\n\n  // Manage focus for open state\n  const { findFirstFocusable } = useFocusFinders();\n  const focusFirst = React.useCallback(() => {\n    const firstFocusable = findFirstFocusable(state.menuPopoverRef.current);\n    firstFocusable?.focus();\n  }, [findFirstFocusable, state.menuPopoverRef]);\n\n  const firstMount = useFirstMount();\n  React.useEffect(() => {\n    if (open) {\n      focusFirst();\n    } else {\n      if (!firstMount) {\n        if (targetDocument?.activeElement === targetDocument?.body) {\n          // We know that React effects are sync so we focus the trigger here\n          // after any event handler (event handlers will update state and re-render).\n          // Since the browser only performs the default behaviour for the Tab key once\n          // keyboard events have fully bubbled up the window, the browser will move\n          // focus to the next tabbable element before/after the trigger if needed.\n          // If the Tab key was not pressed, focus will remain on the trigger as expected.\n          state.triggerRef.current?.focus();\n        }\n      }\n    }\n    // firstMount change should not re-run this effect\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [state.triggerRef, state.isSubmenu, open, focusFirst, targetDocument, state.menuPopoverRef]);\n\n  return [open, setOpen] as const;\n};\n"],"names":["useMenu_unstable","submenuFallbackPositions","props","isSubmenu","useIsSubmenu","hoverDelay","inline","hasCheckmarks","hasIcons","closeOnScroll","openOnContext","persistOnItemClick","openOnHover","defaultCheckedValues","mountNode","safeZone","targetDocument","useFluent","triggerId","useId","contextTarget","setContextTarget","usePositioningMouseTarget","positioningOptions","position","align","target","undefined","fallbackPositions","resolvePositioningShorthand","positioning","children","React","Children","toArray","process","env","NODE_ENV","length","console","warn","menuTrigger","menuPopover","targetRef","containerRef","usePositioning","enableSafeZone","safeZoneDescriptorRef","useRef","isInside","mouseCoordinates","x","y","safeZoneHandle","useSafeZoneArea","disabled","timeout","onSafeZoneEnter","e","setOpen","open","keyboard","type","event","current","onSafeZoneLeave","onSafeZoneMove","clientX","clientY","onSafeZoneTimeout","CustomEvent","MENU_SAFEZONE_TIMEOUT_EVENT","elementsInPoint","elementsFromPoint","menuItemEl","find","el","classList","contains","menuItemClassNames","root","dispatchEvent","triggerRef","useMergedRefs","menuPopoverRef","useMenuOpenState","defaultOpen","onOpenChange","checkedValues","onCheckedValueChange","useMenuSelectableState","components","elementToRender","setCheckedValues","useControllableState","state","defaultState","initialState","useEventCallback","name","checkedItems","currentValue","parentSetOpen","useMenuContext_unstable","context","data","enteringTriggerRef","setOpenState","trySetOpen","MENU_ENTER_EVENT","detail","nativeEvent","bubble","setOpenTimeout","clearOpenTimeout","useTimeout","Event","persist","shouldUseDelay","ignoreHoverDelay","useOnClickOutside","elementContains","element","refs","filter","Boolean","callback","useOnScrollOutside","useOnMenuMouseEnter","findFirstFocusable","useFocusFinders","focusFirst","useCallback","firstFocusable","focus","firstMount","useFirstMount","useEffect","activeElement","body"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}