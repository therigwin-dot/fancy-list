{"version":3,"sources":["../src/utils/useListboxSlot.ts"],"sourcesContent":["import * as React from 'react';\nimport { type FieldControlProps, useFieldControlProps_unstable } from '@fluentui/react-field';\nimport {\n  mergeCallbacks,\n  useId,\n  useEventCallback,\n  slot,\n  isResolvedShorthand,\n  useMergedRefs,\n} from '@fluentui/react-utilities';\nimport type { ExtractSlotProps, Slot, SlotComponentType } from '@fluentui/react-utilities';\nimport type { ComboboxBaseState } from './ComboboxBase.types';\nimport { Listbox } from '../Listbox';\nimport { ListboxProps } from '../Listbox';\n\nexport type UseListboxSlotState = Pick<ComboboxBaseState, 'multiselect'>;\n\ntype UseListboxSlotOptions = {\n  state: UseListboxSlotState;\n  triggerRef:\n    | React.RefObject<HTMLInputElement>\n    | React.RefObject<HTMLButtonElement>\n    | React.RefObject<HTMLButtonElement | HTMLInputElement>;\n  defaultProps?: Partial<ListboxProps>;\n};\n\n/**\n * @internal\n * @returns  listbox slot with desired behaviour and props\n */\nexport function useListboxSlot(\n  listboxSlotFromProp: Slot<typeof Listbox> | undefined,\n  ref: React.Ref<HTMLDivElement>,\n  options: UseListboxSlotOptions,\n): SlotComponentType<ExtractSlotProps<Slot<typeof Listbox>>> | undefined {\n  const {\n    state: { multiselect },\n    triggerRef,\n    defaultProps,\n  } = options;\n\n  const listboxId = useId(\n    'fluent-listbox',\n    isResolvedShorthand(listboxSlotFromProp) ? listboxSlotFromProp.id : undefined,\n  );\n\n  const listboxSlot = slot.optional(listboxSlotFromProp, {\n    renderByDefault: true,\n    elementType: Listbox,\n    defaultProps: {\n      id: listboxId,\n      multiselect,\n      tabIndex: undefined,\n      ...defaultProps,\n    },\n  });\n\n  const fieldControlProps = useFieldControlProps_unstable({ id: listboxId } as FieldControlProps, {\n    supportsLabelFor: true,\n  });\n\n  // Use the field's label to provide an accessible name for the listbox if it doesn't already have one\n  if (\n    listboxSlot &&\n    !listboxSlot['aria-label'] &&\n    !listboxSlot['aria-labelledby'] &&\n    fieldControlProps['aria-labelledby']\n  ) {\n    listboxSlot['aria-labelledby'] = fieldControlProps['aria-labelledby'];\n  }\n\n  /**\n   * Clicking on the listbox should never blur the trigger\n   * in a combobox\n   */\n  const onMouseDown = useEventCallback(\n    mergeCallbacks((event: React.MouseEvent<HTMLDivElement>) => {\n      event.preventDefault();\n    }, listboxSlot?.onMouseDown),\n  );\n\n  const onClick = useEventCallback(\n    mergeCallbacks((event: React.MouseEvent<HTMLDivElement>) => {\n      event.preventDefault();\n      triggerRef.current?.focus();\n    }, listboxSlot?.onClick),\n  );\n\n  const listboxRef = useMergedRefs(listboxSlot?.ref, ref);\n  if (listboxSlot) {\n    listboxSlot.ref = listboxRef;\n    listboxSlot.onMouseDown = onMouseDown;\n    listboxSlot.onClick = onClick;\n  }\n\n  return listboxSlot;\n}\n"],"names":["useListboxSlot","listboxSlotFromProp","ref","options","state","multiselect","triggerRef","defaultProps","listboxId","useId","isResolvedShorthand","id","undefined","listboxSlot","slot","optional","renderByDefault","elementType","Listbox","tabIndex","fieldControlProps","useFieldControlProps_unstable","supportsLabelFor","onMouseDown","useEventCallback","mergeCallbacks","event","preventDefault","onClick","current","focus","listboxRef","useMergedRefs"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BA8BgBA;;;eAAAA;;;;iEA9BO;4BAC+C;gCAQ/D;yBAGiB;AAkBjB,SAASA,eACdC,mBAAqD,EACrDC,GAA8B,EAC9BC,OAA8B;IAE9B,MAAM,EACJC,OAAO,EAAEC,WAAW,EAAE,EACtBC,UAAU,EACVC,YAAY,EACb,GAAGJ;IAEJ,MAAMK,YAAYC,IAAAA,qBAAAA,EAChB,kBACAC,IAAAA,mCAAAA,EAAoBT,uBAAuBA,oBAAoBU,EAAE,GAAGC;IAGtE,MAAMC,cAAcC,oBAAAA,CAAKC,QAAQ,CAACd,qBAAqB;QACrDe,iBAAiB;QACjBC,aAAaC,gBAAAA;QACbX,cAAc;YACZI,IAAIH;YACJH;YACAc,UAAUP;YACV,GAAGL,YAAY;QACjB;IACF;IAEA,MAAMa,oBAAoBC,IAAAA,yCAAAA,EAA8B;QAAEV,IAAIH;IAAU,GAAwB;QAC9Fc,kBAAkB;IACpB;IAEA,qGAAqG;IACrG,IACET,eACA,CAACA,WAAW,CAAC,aAAa,IAC1B,CAACA,WAAW,CAAC,kBAAkB,IAC/BO,iBAAiB,CAAC,kBAAkB,EACpC;QACAP,WAAW,CAAC,kBAAkB,GAAGO,iBAAiB,CAAC,kBAAkB;IACvE;IAEA;;;GAGC,GACD,MAAMG,cAAcC,IAAAA,gCAAAA,EAClBC,IAAAA,8BAAAA,EAAe,CAACC;QACdA,MAAMC,cAAc;IACtB,GAAGd,gBAAAA,QAAAA,gBAAAA,KAAAA,IAAAA,KAAAA,IAAAA,YAAaU,WAAW;IAG7B,MAAMK,UAAUJ,IAAAA,gCAAAA,EACdC,IAAAA,8BAAAA,EAAe,CAACC;YAEdpB;QADAoB,MAAMC,cAAc;QACpBrB,CAAAA,sBAAAA,WAAWuB,OAAO,AAAPA,MAAO,QAAlBvB,wBAAAA,KAAAA,IAAAA,KAAAA,IAAAA,oBAAoBwB,KAAK;IAC3B,GAAGjB,gBAAAA,QAAAA,gBAAAA,KAAAA,IAAAA,KAAAA,IAAAA,YAAae,OAAO;IAGzB,MAAMG,aAAaC,IAAAA,6BAAAA,EAAcnB,gBAAAA,QAAAA,gBAAAA,KAAAA,IAAAA,KAAAA,IAAAA,YAAaX,GAAG,EAAEA;IACnD,IAAIW,aAAa;QACfA,YAAYX,GAAG,GAAG6B;QAClBlB,YAAYU,WAAW,GAAGA;QAC1BV,YAAYe,OAAO,GAAGA;IACxB;IAEA,OAAOf;AACT"}