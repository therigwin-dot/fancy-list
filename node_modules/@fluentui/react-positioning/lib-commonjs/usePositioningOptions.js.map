{"version":3,"sources":["../src/usePositioningOptions.ts"],"sourcesContent":["import { devtools } from '@floating-ui/devtools';\nimport { hide as hideMiddleware, arrow as arrowMiddleware } from '@floating-ui/dom';\nimport type { Middleware } from '@floating-ui/dom';\nimport { useFluent_unstable as useFluent } from '@fluentui/react-shared-contexts';\nimport * as React from 'react';\n\nimport {\n  shift as shiftMiddleware,\n  flip as flipMiddleware,\n  coverTarget as coverTargetMiddleware,\n  maxSize as maxSizeMiddleware,\n  resetMaxSize as resetMaxSizeMiddleware,\n  offset as offsetMiddleware,\n  intersecting as intersectingMiddleware,\n  matchTargetSize as matchTargetSizeMiddleware,\n} from './middleware';\nimport type { PositioningConfigurationFn, PositioningConfigurationFnOptions, PositioningOptions } from './types';\nimport { toFloatingUIPlacement, hasScrollParent, normalizeAutoSize } from './utils';\nimport { devtoolsCallback } from './utils/devtools';\nimport { usePositioningConfiguration } from './PositioningConfigurationContext';\n\n/**\n * @internal\n *\n * This is redundant and exists only to manage React dependencies properly & avoid leaking individual options to the\n * scope of `usePositioningOptions`.\n */\nfunction usePositioningConfigFn(\n  configFn: PositioningConfigurationFn,\n  options: PositioningOptions,\n): (container: HTMLElement, arrow: HTMLElement | null) => PositioningConfigurationFnOptions {\n  const {\n    align,\n    arrowPadding,\n    autoSize,\n    coverTarget,\n    disableUpdateOnResize,\n    flipBoundary,\n    offset,\n    overflowBoundary,\n    pinned,\n    position,\n    // eslint-disable-next-line @typescript-eslint/naming-convention\n    unstable_disableTether,\n    strategy,\n    overflowBoundaryPadding,\n    fallbackPositions,\n    useTransform,\n    matchTargetSize,\n    shiftToCoverTarget,\n  } = options;\n\n  return React.useCallback(\n    (container: HTMLElement, arrow: HTMLElement | null) => {\n      return configFn({\n        container,\n        arrow,\n        options: {\n          autoSize,\n          disableUpdateOnResize,\n          matchTargetSize,\n          offset,\n          strategy,\n          coverTarget,\n          flipBoundary,\n          overflowBoundary,\n          useTransform,\n          overflowBoundaryPadding,\n          pinned,\n          arrowPadding,\n          align,\n          fallbackPositions,\n          shiftToCoverTarget,\n          position,\n          // eslint-disable-next-line @typescript-eslint/naming-convention\n          unstable_disableTether,\n        },\n      });\n    },\n    [\n      autoSize,\n      disableUpdateOnResize,\n      matchTargetSize,\n      offset,\n      strategy,\n      coverTarget,\n      flipBoundary,\n      overflowBoundary,\n      useTransform,\n      overflowBoundaryPadding,\n      pinned,\n      arrowPadding,\n      align,\n      fallbackPositions,\n      shiftToCoverTarget,\n      position,\n      unstable_disableTether,\n      configFn,\n    ],\n  );\n}\n\n/**\n * @internal\n */\nexport function usePositioningOptions(options: PositioningOptions) {\n  const { dir, targetDocument } = useFluent();\n  const isRtl = dir === 'rtl';\n\n  const configFn = usePositioningConfigFn(usePositioningConfiguration(), options);\n  const {\n    // eslint-disable-next-line @typescript-eslint/no-deprecated\n    positionFixed,\n  } = options;\n\n  return React.useCallback(\n    (container: HTMLElement, arrow: HTMLElement | null) => {\n      const hasScrollableElement = hasScrollParent(container);\n\n      const optionsAfterEnhancement = configFn(container, arrow);\n      const {\n        autoSize,\n        disableUpdateOnResize,\n        matchTargetSize,\n        offset,\n        coverTarget,\n        flipBoundary,\n        overflowBoundary,\n        useTransform,\n        overflowBoundaryPadding,\n        pinned,\n        position,\n        arrowPadding,\n        strategy,\n        align,\n        fallbackPositions,\n        shiftToCoverTarget,\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        unstable_disableTether,\n      } = optionsAfterEnhancement;\n      const normalizedAutoSize = normalizeAutoSize(autoSize);\n\n      const middleware = [\n        normalizedAutoSize && resetMaxSizeMiddleware(normalizedAutoSize),\n        matchTargetSize && matchTargetSizeMiddleware(),\n        offset && offsetMiddleware(offset),\n        coverTarget && coverTargetMiddleware(),\n        !pinned && flipMiddleware({ container, flipBoundary, hasScrollableElement, isRtl, fallbackPositions }),\n        shiftMiddleware({\n          container,\n          hasScrollableElement,\n          overflowBoundary,\n          disableTether: unstable_disableTether,\n          overflowBoundaryPadding,\n          isRtl,\n          shiftToCoverTarget,\n        }),\n        normalizedAutoSize &&\n          maxSizeMiddleware(normalizedAutoSize, { container, overflowBoundary, overflowBoundaryPadding, isRtl }),\n        intersectingMiddleware(),\n        arrow && arrowMiddleware({ element: arrow, padding: arrowPadding }),\n        hideMiddleware({ strategy: 'referenceHidden' }),\n        hideMiddleware({ strategy: 'escaped' }),\n        process.env.NODE_ENV !== 'production' &&\n          targetDocument &&\n          devtools(targetDocument, devtoolsCallback(optionsAfterEnhancement)),\n      ].filter(Boolean) as Middleware[];\n\n      const placement = toFloatingUIPlacement(align, position, isRtl);\n\n      return {\n        placement,\n        middleware,\n        strategy: strategy ?? positionFixed ? ('fixed' as const) : ('absolute' as const),\n\n        disableUpdateOnResize,\n        useTransform,\n      };\n    },\n    [configFn, isRtl, targetDocument, positionFixed],\n  );\n}\n"],"names":["usePositioningOptions","usePositioningConfigFn","configFn","options","align","arrowPadding","autoSize","coverTarget","disableUpdateOnResize","flipBoundary","offset","overflowBoundary","pinned","position","unstable_disableTether","strategy","overflowBoundaryPadding","fallbackPositions","useTransform","matchTargetSize","shiftToCoverTarget","React","useCallback","container","arrow","dir","targetDocument","useFluent","isRtl","usePositioningConfiguration","positionFixed","hasScrollableElement","hasScrollParent","optionsAfterEnhancement","normalizedAutoSize","normalizeAutoSize","middleware","resetMaxSizeMiddleware","matchTargetSizeMiddleware","offsetMiddleware","coverTargetMiddleware","flipMiddleware","shiftMiddleware","disableTether","maxSizeMiddleware","intersectingMiddleware","arrowMiddleware","element","padding","hideMiddleware","process","env","NODE_ENV","devtools","devtoolsCallback","filter","Boolean","placement","toFloatingUIPlacement"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}