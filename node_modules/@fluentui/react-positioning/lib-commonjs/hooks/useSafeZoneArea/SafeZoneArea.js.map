{"version":3,"sources":["../src/hooks/useSafeZoneArea/SafeZoneArea.tsx"],"sourcesContent":["import { mergeClasses } from '@griffel/react';\nimport { useId } from '@fluentui/react-utilities';\nimport * as React from 'react';\nimport { useSyncExternalStore } from 'use-sync-external-store/shim';\n\nimport type { createSafeZoneAreaStateStore } from './createSafeZoneAreaStateStore';\nimport { getRectCorners } from './getRectCorners';\nimport { getMouseAnchor } from './getMouseAnchor';\nimport { pointsToSvgPath } from './pointsToSvgPath';\nimport { useStyles } from './SafeZoneArea.styles';\nimport type { Point } from './types';\nimport { computeOutsideClipPath } from './computeOutsideClipPath';\n\nexport type SafeZoneAreaImperativeHandle = {\n  updateSVG: (options: { containerRect: DOMRect; targetRect: DOMRect; mouseCoordinates: Point }) => void;\n};\n\nexport type SafeZoneAreaProps = {\n  /** Enables debug mode: makes drawn shapes visible. */\n  debug: boolean;\n\n  /** A reference to the SafeZoneArea imperative handle. */\n  imperativeRef: React.Ref<SafeZoneAreaImperativeHandle>;\n\n  // eslint-disable-next-line @nx/workspace-consistent-callback-type\n  onMouseEnter: (e: React.MouseEvent) => void;\n  // eslint-disable-next-line @nx/workspace-consistent-callback-type\n  onMouseMove: (e: React.MouseEvent) => void;\n  // eslint-disable-next-line @nx/workspace-consistent-callback-type\n  onMouseLeave: (e: React.MouseEvent) => void;\n\n  stateStore: ReturnType<typeof createSafeZoneAreaStateStore>;\n};\n\n/**\n * @internal\n */\ntype SafeZoneAreaState = {\n  containerRect: DOMRect;\n  targetRect: DOMRect;\n  mouseCoordinates: Point;\n};\n\n// ---\n\nconst EMPTY_RECT: DOMRect = {\n  top: 0,\n  right: 0,\n  bottom: 0,\n  left: 0,\n  width: 0,\n  height: 0,\n  x: 0,\n  y: 0,\n  toJSON() {\n    return '';\n  },\n};\n\nexport function isSameRect(a: DOMRect, b: DOMRect) {\n  return (\n    a.top === b.top &&\n    a.right === b.right &&\n    a.bottom === b.bottom &&\n    a.left === b.left &&\n    a.width === b.width &&\n    a.height === b.height\n  );\n}\n\nexport function isSameCoordinates(a: Point, b: Point) {\n  return a[0] === b[0] && a[1] === b[1];\n}\n\n// ---\n\n/**\n * A component that renders a safe zone area with SVG shapes. Uses `useSyncExternalStore` to manage its active state\n * to avoid causing re-renders in `useSafeZoneArea()` as the hook might be used in host components like `Menu`.\n *\n * Draws two shapes:\n * - a triangle that points to the target element which is an actual safe zone\n * - a rectangle for a clip path that clips out the target element\n *\n * @internal\n */\nexport const SafeZoneArea = React.memo((props: SafeZoneAreaProps) => {\n  const { debug, onMouseEnter, onMouseMove, onMouseLeave, stateStore } = props;\n\n  const clipPathId = useId();\n  const styles = useStyles();\n\n  const active = useSyncExternalStore(stateStore.subscribe, stateStore.isActive);\n  const svgRef = React.useRef<SVGSVGElement>(null);\n\n  const [state, setState] = React.useState<SafeZoneAreaState>(() => ({\n    containerRect: EMPTY_RECT,\n    targetRect: EMPTY_RECT,\n    mouseCoordinates: [0, 0],\n  }));\n\n  React.useImperativeHandle(\n    props.imperativeRef,\n    () => ({\n      updateSVG(newState) {\n        setState(prevState => {\n          // Heads up!\n          // A small optimization to avoid unnecessary re-renders\n          if (\n            isSameRect(prevState.containerRect, newState.containerRect) &&\n            isSameRect(prevState.targetRect, newState.targetRect) &&\n            isSameCoordinates(prevState.mouseCoordinates, newState.mouseCoordinates)\n          ) {\n            return prevState;\n          }\n\n          return newState;\n        });\n      },\n    }),\n    [],\n  );\n\n  const { containerRect, targetRect, mouseCoordinates } = state;\n\n  const topOffset = Math.min(targetRect.top, containerRect.top);\n  const leftOffset = Math.min(targetRect.left, containerRect.left);\n  const bottomOffset = Math.max(targetRect.bottom, containerRect.bottom);\n  const rightOffset = Math.max(targetRect.right, containerRect.right);\n\n  // ---\n\n  const containerCorners = getRectCorners(containerRect, [leftOffset, topOffset]);\n  const targetCorners = getRectCorners(targetRect, [leftOffset, topOffset]);\n\n  // Heads up!\n  // The SVG coordinate system starts at the top-left corner of the SVG element,\n  // so we need to adjust the mouse coordinates relative to the SVG's top-left corner.\n  const relativeMouseCoordinates: Point = [mouseCoordinates[0] - leftOffset, mouseCoordinates[1] - topOffset];\n  const mouseAnchor = getMouseAnchor(containerCorners.topLeft, containerCorners.bottomRight, relativeMouseCoordinates);\n\n  const triangleA = [mouseAnchor, containerCorners.topLeft, containerCorners.topRight];\n  const triangleB = [mouseAnchor, containerCorners.topRight, containerCorners.bottomRight];\n  const triangleC = [mouseAnchor, containerCorners.bottomRight, containerCorners.bottomLeft];\n  const triangleD = [mouseAnchor, containerCorners.bottomLeft, containerCorners.topLeft];\n\n  const svgWidth = rightOffset - leftOffset;\n  const svgHeight = bottomOffset - topOffset;\n\n  const clipPath = computeOutsideClipPath(\n    svgWidth,\n    svgHeight,\n    {\n      x: targetCorners.topLeft[0],\n      y: targetCorners.topLeft[1],\n      width: targetRect.width,\n      height: targetRect.height,\n    },\n    {\n      x: containerCorners.topLeft[0],\n      y: containerCorners.topLeft[1],\n      width: containerRect.width,\n      height: containerRect.height,\n    },\n  );\n\n  return (\n    <div className={mergeClasses(styles.wrapper, active && styles.wrapperActive)} data-safe-zone=\"\">\n      {active ? (\n        <svg\n          aria-hidden\n          className={styles.svg}\n          xmlns=\"http://www.w3.org/2000/svg\"\n          ref={svgRef}\n          style={{\n            width: `${svgWidth}px`,\n            height: `${svgHeight}px`,\n            transform: `translate(${leftOffset}px, ${topOffset}px)`,\n          }}\n        >\n          <g\n            className={mergeClasses(styles.triangle, debug && styles.triangleDebug)}\n            clipPath={`url(#${clipPathId})`}\n            onMouseEnter={onMouseEnter}\n            onMouseMove={onMouseMove}\n            onMouseLeave={onMouseLeave}\n          >\n            <path d={pointsToSvgPath(triangleA)} />\n            <path d={pointsToSvgPath(triangleB)} />\n            <path d={pointsToSvgPath(triangleC)} />\n            <path d={pointsToSvgPath(triangleD)} />\n          </g>\n\n          <clipPath id={clipPathId}>\n            <path d={clipPath} />\n          </clipPath>\n\n          {debug && <path className={styles.rectDebug} d={clipPath} />}\n        </svg>\n      ) : null}\n    </div>\n  );\n});\n"],"names":["SafeZoneArea","isSameCoordinates","isSameRect","EMPTY_RECT","top","right","bottom","left","width","height","x","y","toJSON","a","b","React","memo","props","debug","onMouseEnter","onMouseMove","onMouseLeave","stateStore","clipPathId","useId","styles","useStyles","active","useSyncExternalStore","subscribe","isActive","svgRef","useRef","state","setState","useState","containerRect","targetRect","mouseCoordinates","useImperativeHandle","imperativeRef","updateSVG","newState","prevState","topOffset","Math","min","leftOffset","bottomOffset","max","rightOffset","containerCorners","getRectCorners","targetCorners","relativeMouseCoordinates","mouseAnchor","getMouseAnchor","topLeft","bottomRight","triangleA","topRight","triangleB","triangleC","bottomLeft","triangleD","svgWidth","svgHeight","clipPath","computeOutsideClipPath","createElement","div","className","mergeClasses","wrapper","wrapperActive","data-safe-zone","svg","aria-hidden","xmlns","ref","style","transform","g","triangle","triangleDebug","path","d","pointsToSvgPath","id","rectDebug"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"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"}