"use strict";(self["webpackJsonp_f9e737b7-f0df-4597-ba8c-3060f82380db_1.21.1"]=self["webpackJsonp_f9e737b7-f0df-4597-ba8c-3060f82380db_1.21.1"]||[]).push([[872],{7225:(e,t,n)=>{n.r(t),n.d(t,{ContentPanelController:()=>v});var a=n(280),i=n(9676),r=n(1762),o=n(8698),s=n(2207),c=n(8414);function d(e){var t;return Boolean(e&&Object.prototype.hasOwnProperty.call(e,"context")&&(null===(t=null==e?void 0:e.context)||void 0===t?void 0:t.manifest))}function l(e){var t,n=d(e)?e.context.manifest.id:void 0;return!!n&&"WebPart"===(null===(t=c.SPComponentLoader.tryGetManifestById(n))||void 0===t?void 0:t.componentType)}var u=n(7620),f=n(1104),p=function(){var e=new Set(["VivaTopicsPane","CopilotPane","f3bc67ee-015d-4678-a95f-c7e90ea62c1e","e6b93447-8007-4f1e-934f-754a0031a769","DebugWindow_EnabledPane","FiltersPane","InfoPane","ColumnCustomizationPane","PageCopyToPane","PageVersionsPane","DashboardAudiencePickerPane","AmplifyAuthoringPane","VivaTopicsCopilotPane"]);return(0,u.NG)()||e.add("PageSettingsPane"),e},m=new Set(["c15acc49-b9a9-41cc-bc10-5e96bf2ed4aa","22d34cf7-f7ce-4131-a3e9-52542021f3dc","e377ea37-9047-43b9-8cdb-a761be2f8e09","a922c05b-766f-4409-9985-a4806230ad38","0f087d7f-520e-42b7-89c0-496aaf979d58","df8e44e7-edd5-46d5-90da-aca1539313b8","7b317bca-c919-4982-af2f-8399173e5a1e","893a257e-9c92-49bc-8a36-2f6bb058da34","490d7c76-1824-45b2-9de3-676421c997fa","daf0b71c-6de8-4ef7-b511-faae7c388708","62cac389-787f-495d-beca-e11786162ef4","df851228-e2ea-407c-8d93-22e4617118ca","71c19a43-d08c-4178-8218-4df8554c0b0e","9cc0f495-db64-4d74-b06b-a3de16231fe1","2161a1c6-db61-4731-b97c-3cdb303f7cbb","6ee6fe3d-ed5f-4c42-b663-b1df52a8ae3b","b7dd04e1-19ce-4b24-9132-b60a1c2b910d","275c0095-a77e-4f6d-a2a0-6a7626911518","20745d7d-8581-4a6c-bf26-68279bc123fc","31852200-9cac-450e-b180-be8f12c0ab81","cf91cf5d-ac23-4a7a-9dbc-cd9ea2a4e859","2a8b07f2-b38f-4df0-8e8b-2cd2a8b8d32b","b19b3b9e-8d13-4fec-a93c-401a091c0707","6676088b-e28e-4a90-b9cb-d0d0303cd2eb","c4bd7b2f-7b6e-4599-8485-16504575f590","af8be689-990e-492a-81f7-ba3e4cd3ed9c","5e945ea8-0e6c-4f52-b7c2-75ae618396e5","d1d91016-032f-456d-98a4-721247c305e8","fe2f2812-4df0-42c7-ae2e-2db57e092751","46698648-fcd5-41fc-9526-c7f7b2ace919","6410b3b6-d440-4663-8744-378976dc041e","a8cd4347-f996-48c1-bcfb-75373fed2a27","f92bf067-bc19-489e-a556-7fe95f508720","1ef5ed11-ce7b-44be-bc5e-4abd55101d16","141c7740-14ce-4cd4-bc96-93a5b8ef8e65","8bcd4369-10e6-46a9-b718-fa47db2864ca","e19cef07-c1ad-42ea-a3d8-a536d6415476","4bdfb4be-6e39-4b1d-af8b-addbd3a582ff","b519c4f1-5cf7-4586-a678-2f1c62cc175a","1f1a4f4f-c926-4a8e-b14c-564e2f8cf47a","0ef418ba-5d19-4ade-9db0-b339873291d0","c1b5736d-84dd-4fdb-a7be-e7e9037bd3c3","a5df8fdf-b508-4b66-98a6-d83bc2597f63","8c88f208-6c77-4bdb-86a0-0c47b4316588","e84a8ca2-f63c-4fb9-bc0b-d8eef5ccb22b","cbe7b0a9-3504-44dd-a3a3-0e5cacd07788","102f1fc1-3369-4372-8e44-f27dd11a9377","7f718435-ee4d-431c-bdbf-9c4ff326f46e","39c4c1c2-63fa-41be-8cc2-f6c0b49b253d","9d7e898c-f1bb-473a-9ace-8b415036578b","58fcd18b-e1af-4b0a-b23b-422c2c52d5a2","91a50c94-865f-4f5c-8b4e-e49659e69772","c70391ea-0b10-4ee9-b2b4-006d3fcad0cd","cb62a581-d010-4b84-8eeb-b6388a25fdcf","1ee8960a-2fa0-4145-b9bb-e818f6cf18e7","29991a50-6f14-42e0-9536-aef85d91b05c","8670c27e-8fb2-46a9-a4fe-ea4515d2d9e1","9346e298-66c6-4122-853c-a1eef08b5827","9ac82c99-6122-45e3-8fc6-b83d3cf1c0a8","0d46c45e-2eaa-4010-9095-ea21f3046bf9","eb95c819-ab8f-4689-bd03-0c2d65d47b1f","7cba020c-5ccb-42e8-b6fc-75b3149aba7b","8654b779-4886-46d4-8ffb-b5ed960ee986","b3a690f0-bed6-4ccb-a186-ed70412fc35b","f3bc67ee-015d-4678-a95f-c7e90ea62c1e","d0a64d22-555c-44e4-b120-aed62c263632","e6b93447-8007-4f1e-934f-754a0031a769","2f3b693c-1054-419c-af04-fee2782b414f","ac0e47ca-30af-452c-bdbb-510b715d0e46","16e05eca-76f9-4209-b132-b610a3127aa4","e30ff702-e1a4-4e02-8c11-3cce0139727a","e9ee7242-273c-473f-bfa5-149b32873501","c12e69f3-404a-4ae7-b11a-bfd1175a7b00","e3b2b12f-4fae-4c51-b593-dce186c7b7b5","39665c7c-348f-4763-b2bc-c40cbfaa3d3d","f6fdf4f8-4a24-437b-a127-32e66a5dd9b4","da50fda6-c108-4ceb-a2b2-7ebb96a8925e","8902cf6d-22e5-4615-b036-57c613b8db6b","868ac3c3-cad7-4bd6-9a1c-14dc5cc8e823","81b57906-cbed-4bb1-9823-2e3314f46f28","31e9537e-f9dc-40a4-8834-0e3b7df418bc","cb3bfe97-a47f-47ca-bffb-bb9a5ff83d75","544dd15b-cf3c-441b-96da-004d5a8cea1d"]),_=n(9496),h=n(6207);function b(){var e=p();return[r.SPPagesContentPanelPivot.configurationTools,r.SPPagesContentPanelPivot.pageDetails].filter(function(t){return!e.has(t)})}function g(e){return(0,u.NG)()&&"PageSettingsPane"===e?r.SPPagesContentPanelPivot.pageDetails:r.SPPagesContentPanelPivot.configurationTools}var v=function(){function e(){var e=this;this._consumers=new Map,this._currentlyConfiguredConsumerIdByPivot=new Map(b().map(function(e){return[e,void 0]})),this.addOnUpdateListener=function(e){return r.SPPagesContentPanelProviderContext.getInstance().addOnUpdateListener(e)},this._onContentPanelUpdated=function(t){var n=t.stateContext,a=e._currentlyConfiguredConsumerIdByPivot.get(n.activePivot);e._currentlyConfiguredConsumerIdByPivot.has(n.activePivot)&&a!==e.currentlyConfiguredConsumerId&&(!a||e._consumers.has(a)?e._setCurrentlyConfiguredConsumerId(a):(e._setCurrentlyConfiguredConsumerId(void 0),e._currentlyConfiguredConsumerIdByPivot.set(n.activePivot,void 0)))},this._onContentPanelMount=function(t){var n=t.subscriberContext;s._TraceLogger.logVerbose(_.Y,"ContentPanel mounted");var a="ContentPanelController";n.addCommandListener({handlerId:a,commandId:r.SPPagesContentPanelCommandId.propertyPaneConfigurationEvent,commandHandler:function(t){var n=t.commandData;e._onConfigurationEvent(n)}}),n.addCommandListener({handlerId:a,commandId:r.SPPagesContentPanelCommandId.propertyPaneFieldChange,commandHandler:function(t){var n=t.consumerId,a=t.commandData;n===e.currentlyConfiguredConsumerId&&e._onPropertyPaneFieldChanged.apply(e,a)}}),n.addCommandListener({handlerId:a,commandId:r.SPPagesContentPanelCommandId.refreshPropertyPane,commandHandler:function(t){var n=t.consumerId;e.currentlyConfiguredConsumerId===n&&n&&e._updateContentPanelData(e.currentlyConfiguredConsumerId).catch(function(e){s._TraceLogger.logError(_.Y,e)})}})},this._onPropertyPaneFieldChanged=this._onPropertyPaneFieldChanged.bind(this),this._onConfigurationEvent=this._onConfigurationEvent.bind(this),this._fireConfigurationEvent=this._fireConfigurationEvent.bind(this),r.SPPagesContentPanelProviderContext.getInstance().addOnMountListener(this._onContentPanelMount,function(e){s._TraceLogger.logError(_.Y,e)}),(0,u.NG)()&&r.SPPagesContentPanelProviderContext.getInstance().addOnUpdateListener(this._onContentPanelUpdated)}return Object.defineProperty(e.prototype,"currentlyConfiguredConsumerId",{get:function(){return this._currentlyConfiguredConsumerId},enumerable:!1,configurable:!0}),e.isContentPanelSupported=function(){var e=r.SPPagesContentPanelProviderContext.getInstance().subscriberContext;return(0,u.zy)()&&((0,u.NG)()?b().some(function(t){return null==e?void 0:e.isPivotRendered(t)}):!!(null==e?void 0:e.isPivotRendered(r.SPPagesContentPanelPivot.configurationTools)))},e._isConsumerPivotTheActivePivot=function(e){var t;return g(e)===(null===(t=r.SPPagesContentPanelProviderContext.getInstance().stateContext)||void 0===t?void 0:t.activePivot)},e.prototype.registerOnPropertyPaneFieldChangedListener=function(e,t){return function(){}},e.prototype.registerConsumer=function(e,t){i.Validate.isNonemptyString(e,"instanceId"),i.Validate.isNotNullOrUndefined(t,"consumer"),this._consumers.set(e,t),this._unregistredBackgroundRefreshConsumerId===e&&this.requestAction(e,"BackgroundRefresh")},e.prototype.isConsumerRegistered=function(e){return this._consumers.has(e)},e.prototype.requestAction=function(t,n,a,i){switch(void 0===n&&(n="Default"),this._unregistredBackgroundRefreshConsumerId=void 0,n){case"Open":case"OpenDetails":this._openContentPanel(t,a,"OpenDetails"===n,i).catch(function(e){s._TraceLogger.logError(_.Y,e)});break;case"Close":case"Unmount":this._closeContentPanel(t);break;case"Toggle":(0,u.NG)()?this.isOpen()&&e._isConsumerPivotTheActivePivot(t)&&((0,h.zB)()||this._isCurrentlyConfiguredConsumerForPivot(t))?this.requestAction(t,"Close",a,i):this.requestAction(t,"Open",a,i):this.isOpen()?this.requestAction(t,"Close",a,i):this.requestAction(t,"Open",a,i);break;case"Default":this.isOpen()&&this.requestAction(t,"Open",a,i);break;case"Refresh":this.isOpen()&&((0,u.NG)()?this._isCurrentlyConfiguredConsumerForPivot(t):this.currentlyConfiguredConsumerId===t)&&this._updateContentPanelData(t).catch(function(e){s._TraceLogger.logError(_.Y,e)});break;case"BackgroundRefresh":var r=this._consumers.get(t);this.isOpen()&&(!(0,u.NG)()||d(r)&&l(r))||(this.isComponentSupported(t)?(this._setCurrentlyConfiguredConsumerId(t),this._updateContentPanelData(t).catch(function(e){s._TraceLogger.logError(_.Y,e)})):(this.isConsumerRegistered(t)||(s._TraceLogger.logVerbose(_.Y,"Waiting to register consumer before BackgroundRefresh"),this._unregistredBackgroundRefreshConsumerId=t),this._resetCurrentlyConfiguredConsumer()))}},e.prototype.isRenderedByConsumer=function(){return!!this._isPaneRenderedByWebPart},e.prototype.isOpen=function(){var e=r.SPPagesContentPanelProviderContext.getInstance().stateContext;return this.isAnyContentPanelOpen()&&((0,u.NG)()?b().some(function(t){return(null==e?void 0:e.activePivot)===t}):(null==e?void 0:e.activePivot)===r.SPPagesContentPanelPivot.configurationTools)},e.prototype.isAnyContentPanelOpen=function(){var e;return!!(null===(e=r.SPPagesContentPanelProviderContext.getInstance().stateContext)||void 0===e?void 0:e.isVisible)},e.prototype.forceClose=function(){var e;this._closeContentPanel(void 0,!(0,h.a9)()),null===(e=r.SPPagesContentPanelProviderContext.getInstance().subscriberContext)||void 0===e||e.setIsVisible(!1),this._resetCurrentlyConfiguredConsumer()},e.prototype.onConsumerDelete=function(e){if(i.Validate.isNonemptyString(e,"id"),e===this.currentlyConfiguredConsumerId?this._resetCurrentlyConfiguredConsumer():(0,u.NG)()&&this._isCurrentlyConfiguredConsumerForPivot(e)&&this._resetLoader(e),this._consumers.delete(e),(0,u.NG)()){var t=r.SPPagesContentPanelProviderContext.getInstance().stateContext;(null==t?void 0:t.activePivot)&&this._currentlyConfiguredConsumerIdByPivot.has(t.activePivot)&&this._currentlyConfiguredConsumerIdByPivot.get(t.activePivot)===e&&this._currentlyConfiguredConsumerIdByPivot.set(t.activePivot,void 0)}},e.prototype._setAppPagePropertyPaneTopData=function(e,t){this._title=t,this._topControl=e},e.prototype._setPropertyPaneToNarrowRender=function(e){this._isNarrow=e},e.prototype.isComponentSupported=function(t,n){if(void 0===n&&(n=this._consumers.get(t)),!n||!e.isContentPanelSupported()||p().has(t))return s._TraceLogger.logVerbose(_.Y,"".concat(t," is not supported. (isContentPanelSupported: ").concat(!!e.isContentPanelSupported(),")")),!1;if(this.isConsumerRegistered(t)||!d(n)||!l(n))return!0;var a=c.SPComponentLoader.tryGetManifestById(n.context.manifest.id||"");return(0,u.$v)()&&!(0,h.EE)()?"WebPart"===(null==a?void 0:a.componentType):!!("boolean"==typeof(null==a?void 0:a.isInternal)?a.isInternal:(null==a?void 0:a.id)&&m.has(a.id))},e.prototype._isCurrentlyConfiguredConsumerForPivot=function(e){return e===this._currentlyConfiguredConsumerIdByPivot.get(g(e))},e.prototype._setCurrentlyConfiguredConsumerId=function(e){if(this._currentlyConfiguredConsumerId=e,(0,u.NG)()&&e){var t=g(e);this._currentlyConfiguredConsumerIdByPivot.set(t,e)}},e.prototype._onConfigurationEvent=function(e){switch(s._TraceLogger.logVerbose(_.Y,"Configuration event '".concat(e,"'. (currentlyConfiguredConsumerId: ").concat(this._currentlyConfiguredConsumerId,")")),e){case"Closed":this.requestAction(this.currentlyConfiguredConsumerId||"","Close",this.isRenderedByConsumer());break;case"ApplyClicked":case"LostFocus":this._fireConfigurationEvent(this._currentlyConfiguredConsumerId,e),this._fireConfigurationEvent(this._currentlyConfiguredConsumerId,"ConfigurationComplete");break;case"BackClicked":!(0,h.H5)()&&this._fireConfigurationEvent(this._currentlyConfiguredConsumerId,e)}},e.prototype._onPropertyPaneFieldChanged=function(e,t,n){if(s._TraceLogger.logVerbose(_.Y,"property pane field '".concat(e,"' changed. currentlyConfiguredConsumerId: ").concat(this._currentlyConfiguredConsumerId)),!this._currentlyConfiguredConsumerId){var a=new Error("onPropertyPaneFieldChanged event is not expected when no consumer is being configured");throw s._TraceLogger.logError(_.Y,a),a}var i=this._consumers.get(this._currentlyConfiguredConsumerId);i&&(i._onPropertyPaneFieldChanged(e,t,n),this._updateContentPanelData(this.currentlyConfiguredConsumerId||"").catch(function(e){s._TraceLogger.logError(_.Y,e)})),(null==i?void 0:i._isPropertyPaneReactive())&&this._resetConfigurationCompleteTimeout()},e.prototype._fireConfigurationEvent=function(e,t){this._clearConfigurationCompleteTimeout();var n=this._consumers.get(e||"");if(n){var a={componentId:e,configurationEvent:t};i._SPEventManager.instance.raiseEvent("propertyPaneEvent",a),n._onPropertyPaneLifeCycleEvent(t)}},e.prototype._resetConfigurationCompleteTimeout=function(){this._clearConfigurationCompleteTimeout(),this._configurationCompletionTimeout=window.setTimeout(this._fireConfigurationEvent,f.l,this._currentlyConfiguredConsumerId,"ConfigurationComplete")},e.prototype._clearConfigurationCompleteTimeout=function(){this._configurationCompletionTimeout&&(window.clearTimeout(this._configurationCompletionTimeout),this._configurationCompletionTimeout=void 0)},e.prototype._openContentPanel=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return(0,a.__awaiter)(this,void 0,void 0,function(){var i,o,c,d;return(0,a.__generator)(this,function(l){switch(l.label){case 0:return this.isConsumerRegistered(e)?[4,r.SPPagesContentPanelProviderContext.getInstance().waitForContext]:[2];case 1:return i=l.sent().subscriberContext,(0,u.NG)()&&(o=g(e),!i.isPivotRendered(o))?(s._TraceLogger.logVerbose(_.Y,"Skipping opening, '".concat(o,"' is not rendered")),[2]):(c=!!this.isOpen(),d=this._consumers.get(e),e!==this._currentlyConfiguredConsumerId&&(null==d||d._loadPropertyPaneResources(),this._fireConfigurationEvent(e,"ActiveWebPartChanged")),c?(this._fireConfigurationEvent(this._currentlyConfiguredConsumerId,"ConfigurationComplete"),this._fireConfigurationEvent(e,"ConfigurationStart")):(this._fireConfigurationEvent(e,"ConfigurationStart"),this._fireConfigurationEvent(e,"Opened")),this._isPaneRenderedByWebPart=t,this._setCurrentlyConfiguredConsumerId(e),i.setIsVisible((0,u.NG)()?g(e):r.SPPagesContentPanelPivot.configurationTools),[4,this._updateContentPanelData.apply(this,(0,a.__spreadArray)([e],n,!1))]);case 2:return l.sent(),[2]}})})},e.prototype._updateContentPanelData=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return(0,a.__awaiter)(this,void 0,void 0,function(){var n=this;return(0,a.__generator)(this,function(i){switch(i.label){case 0:return[4,r.SPPagesContentPanelProviderContext.getInstance().waitForContext];case 1:return i.sent().subscriberContext.setLoader((0,u.NG)()?g(e):r.SPPagesContentPanelPivot.configurationTools,function(){var i=n._consumers.get(e),c=new s._QosMonitor((0,r.getQOSName)(_.E,r.SPPagesContentPanelQOSScenarios.rendering,"getPropertyPaneData"));return null==i?void 0:i._getPropertyPaneData.apply(i,t).then(function(t){return c.writeSuccess(),{propertyPaneData:(0,a.__assign)((0,a.__assign)({},t),{title:n._title||t.title}),componentId:e,isNarrow:n._isNarrow,topControl:n._topControl}}).catch(function(t){var n=new o.CustomError({message:(0,o.markPrivacyData)("Failed to get property pane data for '".concat(e,"'"),"safe"),innerError:t});s._TraceLogger.logError(_.Y,n),c.writeUnexpectedFailure("UnhandledError",n,{manifestId:d(i)?i.context.manifest.id:void 0})})}),[2]}})})},e.prototype._resetCurrentlyConfiguredConsumer=function(){var e=this._currentlyConfiguredConsumerId;this._setCurrentlyConfiguredConsumerId(void 0),this._isPaneRenderedByWebPart=void 0,this._resetLoader(e)},e.prototype._resetLoader=function(e){var t;(0,u.NG)()&&!e||null===(t=r.SPPagesContentPanelProviderContext.getInstance().subscriberContext)||void 0===t||t.setLoader((0,u.NG)()&&e?g(e):r.SPPagesContentPanelPivot.configurationTools,function(){})},e.prototype._closeContentPanel=function(e,t){var n=r.SPPagesContentPanelProviderContext.getInstance(),a=n.stateContext,i=n.subscriberContext;(null==a?void 0:a.isVisible)&&((0,u.NG)()?e?(null==a?void 0:a.activePivot)===g(e):b().some(function(e){return e===a.activePivot}):(null==a?void 0:a.activePivot)===r.SPPagesContentPanelPivot.configurationTools)&&(null==i||i.setIsVisible(!1),t||(this._fireConfigurationEvent(this._currentlyConfiguredConsumerId,"ConfigurationComplete"),this._fireConfigurationEvent(this._currentlyConfiguredConsumerId,"Closed")),s._TraceLogger.logVerbose(_.Y,"Closed content panel"))},e}()}
}]);