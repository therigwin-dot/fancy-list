{"version":3,"file":"ShrinkwrapFilePolicy.js","sourceRoot":"","sources":["../../../src/logic/policy/ShrinkwrapFilePolicy.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;;AAK3D,oEAAiE;AAQjE;;GAEG;AACH,SAAgB,QAAQ,CACtB,iBAAoC,EACpC,QAAkB,EAClB,OAA2B,EAC3B,OAAgC;IAEhC,sCAAsC;IACtC,OAAO,CAAC,GAAG,CAAC,+CAA+C,CAAC,CAAC;IAC7D,MAAM,cAAc,GAAmC,6CAAqB,CAAC,iBAAiB,CAC5F,iBAAiB,CAAC,cAAc,EAChC,QAAQ,CAAC,8BAA8B,CAAC,OAAO,CAAC,CACjD,CAAC;IAEF,IAAI,CAAC,cAAc,EAAE,CAAC;QACpB,sCAAsC;QACtC,OAAO,CAAC,GAAG,CAAC,4DAA4D,CAAC,CAAC;QAC1E,OAAO;IACT,CAAC;IAED,qCAAqC;IACrC,cAAc,CAAC,QAAQ,CACrB,iBAAiB,CAAC,qBAAqB,kCAElC,OAAO,KACV,SAAS,EAAE,QAAQ,CAAC,YAAY,EAAE,KAEpC,iBAAiB,CAAC,wBAAwB,CAAC,aAAa,CACzD,CAAC;AACJ,CAAC;AA5BD,4BA4BC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\n// See LICENSE in the project root for license information.\n\nimport type { RushConfiguration } from '../../api/RushConfiguration';\nimport type { IPolicyValidatorOptions } from './PolicyValidator';\nimport type { BaseShrinkwrapFile } from '../base/BaseShrinkwrapFile';\nimport { ShrinkwrapFileFactory } from '../ShrinkwrapFileFactory';\nimport type { RepoStateFile } from '../RepoStateFile';\nimport type { Subspace } from '../../api/Subspace';\n\nexport interface IShrinkwrapFilePolicyValidatorOptions extends IPolicyValidatorOptions {\n  repoState: RepoStateFile;\n}\n\n/**\n *  A policy that validates shrinkwrap files used by package managers.\n */\nexport function validate(\n  rushConfiguration: RushConfiguration,\n  subspace: Subspace,\n  variant: string | undefined,\n  options: IPolicyValidatorOptions\n): void {\n  // eslint-disable-next-line no-console\n  console.log('Validating package manager shrinkwrap file.\\n');\n  const shrinkwrapFile: BaseShrinkwrapFile | undefined = ShrinkwrapFileFactory.getShrinkwrapFile(\n    rushConfiguration.packageManager,\n    subspace.getCommittedShrinkwrapFilePath(variant)\n  );\n\n  if (!shrinkwrapFile) {\n    // eslint-disable-next-line no-console\n    console.log('Shrinkwrap file could not be found, skipping validation.\\n');\n    return;\n  }\n\n  // Run shrinkwrap-specific validation\n  shrinkwrapFile.validate(\n    rushConfiguration.packageManagerOptions,\n    {\n      ...options,\n      repoState: subspace.getRepoState()\n    },\n    rushConfiguration.experimentsConfiguration.configuration\n  );\n}\n"]}