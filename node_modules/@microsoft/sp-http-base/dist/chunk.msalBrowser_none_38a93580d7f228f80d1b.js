"use strict";(self["webpackJsonp_8496636c-2300-4915-abef-20de64c98d8b_1.21.1_"]=self["webpackJsonp_8496636c-2300-4915-abef-20de64c98d8b_1.21.1_"]||[]).push([[92],{8100:(e,t,n)=>{n.d(t,{L:()=>i});var a=n(2207),i=function(){function e(){this._nonceMap=new Map,this._NONCE_REGEX=/nonce="([^"]*)"/}return e.getNonceManager=function(){return null==this._nonceManager&&(this._nonceManager=new e),this._nonceManager},e.prototype.getNonceFromResource=function(e,t){var n=this,i=this._getKey(e),r=this._getNonce(i);if(r&&t)return Promise.resolve(r);var o=new Headers;o.append("Authorization","Bearer"),o.append("Accept-Auth","PoP");var s={method:"HEAD",headers:o,credentials:"omit"};return this._qosMonitor=new a._QosMonitor("NonceManager.GetShrNonce"),fetch(e,s).then(function(t){var a,o,s,c=t.headers.get("www-authenticate");if(401===t.status&&c){var d,l=c.match(n._NONCE_REGEX);return 2!==(null==l?void 0:l.length)?((d=new Error("Unable to fetch nonce from wwwAuthenticate Header: "+c)).name="NonceNotSupported",null===(a=n._qosMonitor)||void 0===a||a.writeUnexpectedFailure("getShrNonceFromResource",d,t),Promise.reject(d)):(r=l[1],n.updateNonceMap(i,r),null===(o=n._qosMonitor)||void 0===o||o.writeSuccess({ResourceEndpoint:e}),Promise.resolve(r))}return(d=new Error("Error while fetching nonce from resource.\n Resource response: "+t)).name="NonceNotSupported",null===(s=n._qosMonitor)||void 0===s||s.writeUnexpectedFailure("getShrNonceFromResource",d,t),Promise.reject(d)}).catch(function(e){var t;return null===(t=n._qosMonitor)||void 0===t||t.writeUnexpectedFailure(e.errorCode,e),Promise.reject(e)})},e.prototype.updateNonceMap=function(e,t){if(!t)throw new Error("updateNonceMap failed as nonce is not present");this._nonceMap[e]=t},e.prototype._getKey=function(e){try{return e.startsWith("http://")||e.startsWith("https://")||(e="https://".concat(e)),new URL(e).hostname}catch(e){throw new Error(e.message+": wrong-url")}},e.prototype._getNonce=function(e){return this._nonceMap[e]?this._nonceMap[e]:""},e}()}
,3595:(e,t,n)=>{n.d(t,{T:()=>s});var a=n(4476),i=n(5244),r=n(9676),o=n(8418),s=function(){function e(){}return e._handleInteractionRequiredFailures=function(t,n,s){e._doesAadErrorCodeExist(n,i.A.UNRESOLVABLE_AAD_ERROR_CODES)||i.A.RESOLVABLE_ERROR_CODES.forEach(function(e){if(n.indexOf(e)>-1){var i=t._getNavigateUrl(t.RESPONSE_TYPE.TOKEN,s)+"&prompt=select_account";r._SPEventManager.instance.raiseEvent(a.Oy._tokenAcquisitionEventId,new a.QL(o.m,i))}})},e._isInteractionRequired=function(t,n){return!e._doesAadErrorCodeExist(t,i.A.UNRESOLVABLE_AAD_ERROR_CODES)&&i.A.RESOLVABLE_ERROR_CODES.has(n)},e._isTokenRenewalTimeout=function(e){return e===i.A.TOKEN_RENEWAL_TIMEOUT},e._isEndpointsResolutionError=function(e){return e===i.A.ENDPOINTS_RESOLUTION_ERROR},e._isSessionDoesNotExistError=function(e,t){return e.indexOf(i.A.SESSION_DOES_NOT_EXIST_ERROR)>-1||t.indexOf(i.A.SESSION_DOES_NOT_EXIST_ERROR)>-1},e._doesAadErrorCodeExist=function(e,t){for(var n=0,a=e.match(/(AADSTS)[0-9]+/g)||[];n<a.length;n++){var i=a[n];if(t.has(i))return!0}return!1},e}()}
,8104:(e,t,n)=>{n.r(t),n.d(t,{MsalBrowserTokenProvider:()=>L});var a=n(280),i=n(676),r=n(3111),o=n(416),s=n(9676),c=n(5244),d=n(3595),l=n(6742),u=n(4476),f=n(350),p=n(8693),m="spfx.msal.currentRedirectStartTime",_="spfx.msal.correlationId",h=function(){function e(e,t,n){this._STORAGE_KEYS={AUTHORITY:"spfx.msal.authority",CLIENT_ID:"spfx.msal.clientId",CURRENT_REDIRECT_ATTEMPT:"spfx.msal.redirectAttemptNumber",FIRST_REDIRECT_TIME:"spfx.msal.firstRedirectTime",IS_REDIRECT_IN_PROGRESS:"spfx.msal.isRedirectInProgress",IS_SSO_SILENT:"spfx.msal.isSsoSillent",REDIRECTED_FROM:"spfx.msal.redirectedFrom",SHOULD_USE_MSAL_BROWSER:"spfx.msal.shouldUseMsalBrowser",V1_CLIENT_ID:"msalRedirectClientId",CURRENT_REDIRECT_START_TIME:m,CORRELATION_ID:_,MSAL_V4_OVERRIDE:"spfx.msalv4.override"},this._authority=e,this._clientId=t,this._shouldUseMsalBrowser=n}return e.prototype.isAllowedToRedirect=function(){return this.hasRedirectAttemptsLeft()&&!this.isRedirectInProgress()},e.prototype.hasRedirectAttemptsLeft=function(){return this.getCurrentNumberOfRedirectAttempts()<e._ALLOWED_REDIRECT_ATTEMPTS},e.prototype.isRedirectInProgress=function(){return this.getCurrentNumberOfRedirectAttempts()>0&&e._isRedirectInProgress},e.prototype.prepareForRedirect=function(t){e._isRedirectInProgress=!0,window.sessionStorage.setItem(this._STORAGE_KEYS.IS_REDIRECT_IN_PROGRESS,"true"),window.sessionStorage.setItem(this._STORAGE_KEYS.MSAL_V4_OVERRIDE,"true"),this._incrementRedirectAttempts(),window.sessionStorage.setItem(this._STORAGE_KEYS.AUTHORITY,this._authority),window.sessionStorage.setItem(this._STORAGE_KEYS.CLIENT_ID,this._clientId),window.sessionStorage.setItem(this._STORAGE_KEYS.REDIRECTED_FROM,window.location.href),window.sessionStorage.setItem(this._STORAGE_KEYS.SHOULD_USE_MSAL_BROWSER,this._shouldUseMsalBrowser.toString()),this._shouldUseMsalBrowser||window.sessionStorage.setItem(this._STORAGE_KEYS.V1_CLIENT_ID,this._clientId),(0,p.sm)()||(this._setCurrentRedirectTimeInSessionStorage(),window.sessionStorage.setItem(this._STORAGE_KEYS.CORRELATION_ID,t||""))},e.prototype.cancelRedirect=function(){window.sessionStorage.removeItem(this._STORAGE_KEYS.AUTHORITY),window.sessionStorage.removeItem(this._STORAGE_KEYS.CLIENT_ID),window.sessionStorage.removeItem(this._STORAGE_KEYS.REDIRECTED_FROM),window.sessionStorage.removeItem(this._STORAGE_KEYS.SHOULD_USE_MSAL_BROWSER),window.sessionStorage.removeItem(this._STORAGE_KEYS.IS_REDIRECT_IN_PROGRESS),e._isRedirectInProgress=!1},e.prototype.getCurrentNumberOfRedirectAttempts=function(){var t=0,n=6e4*e._MAX_REDIRECT_TIME_IN_MIN,a=this._getFirstRedirectTimeFromSessionStorage();if(a){var i=new Date,r=new Date(a);i.getTime()-r.getTime()<n&&(t=this._getRedirectAttemptNumberFromSessionStorage())}return t},e.prototype._incrementRedirectAttempts=function(){var e=this.getCurrentNumberOfRedirectAttempts()+1;1===e&&this._setFirstRedirectTimeInSessionStorage(),this._setRedirectAttemptNumberInSessionStorage(e)},e.prototype._getRedirectAttemptNumberFromSessionStorage=function(){var e=window.sessionStorage.getItem(this._STORAGE_KEYS.CURRENT_REDIRECT_ATTEMPT)||"0";return parseInt(e,10)},e.prototype._setRedirectAttemptNumberInSessionStorage=function(e){window.sessionStorage.setItem(this._STORAGE_KEYS.CURRENT_REDIRECT_ATTEMPT,e.toString())},e.prototype._getFirstRedirectTimeFromSessionStorage=function(){return window.sessionStorage.getItem(this._STORAGE_KEYS.FIRST_REDIRECT_TIME)},e.prototype._setFirstRedirectTimeInSessionStorage=function(){var e=new Date;window.sessionStorage.setItem(this._STORAGE_KEYS.FIRST_REDIRECT_TIME,e.toString())},e.prototype._setCurrentRedirectTimeInSessionStorage=function(){var e=new Date;window.sessionStorage.setItem(this._STORAGE_KEYS.CURRENT_REDIRECT_START_TIME,e.toString())},e._ALLOWED_REDIRECT_ATTEMPTS=2,e._MAX_REDIRECT_TIME_IN_MIN=2,e._isRedirectInProgress=!1,e}();function b(){var e,t="spfx.msal.shouldPrintLogs",n=(null===(e=new URLSearchParams(window.location.search).get("msalLogging"))||void 0===e?void 0:e.toLowerCase())||"";"true"===n?window.sessionStorage.setItem(t,"true"):"false"===n&&window.sessionStorage.removeItem(t);var a=window.sessionStorage.getItem(t)||"";return"true"===n||"true"===a}var g,v=n(5796),y=n(6298),S=n(2549),D=n(7002),I=n(2207),x=function(){function e(){}return e.registerMsalBrowserClient=function(t,n,a,i,r){var o=this,s=e._getClientIdIndex(n,i,r);this._isClientIndexRegistered(s)||(i?e._msalBrowserClients.set(s,this._createMsalBrowserNextClient(t,n,a)):r?e._msalBrowserClients.set(s,this._createMsalBrowserPairwiseBrokerClient(t,n,a,i)):e._msalBrowserClients.set(s,new Promise(function(e){var i=o._createMsalBrowserClient(t,n,a);return i.initialize().then(function(){return i.handleRedirectPromise().then(function(){e(i)}).catch(function(e){if(new I._QosMonitor("MsalBrowserV3ClientManager._handleRedirectPromise").writeUnexpectedFailure(e.errorCode,e),!(0,p.O2)())throw e})}).catch(function(e){if(new I._QosMonitor("MsalBrowserV3ClientManager._initializePromise").writeUnexpectedFailure(e.errorCode,e),!(0,p.O2)())throw e})})))},e.getMsalBrowserClient=function(t,n,a,i,r){var o=e._getClientIdIndex(n,i,r);return this._isClientIndexRegistered(o)||this.registerMsalBrowserClient(t,n,a,i,r),e._msalBrowserClients.get(o)},e._isClientIndexRegistered=function(t){return e._msalBrowserClients.has(t)},e._getClientIdIndex=function(t,n,a){return(0,p.xH)()?t:n?t+e._NAA_CLIENT_SUFFIX:a?t+e._PAIRWISEBROKER_CLIENT_SUFFIX:t},e._createMsalBrowserClient=function(e,t,n){var a=this._getMsalBrowserConfiguration(e,t,n,!1);return new v.v(a)},e._createMsalBrowserNextClient=function(e,t,n){var a=this._getMsalBrowserConfiguration(e,t,n,!0);return(0,y.Ui)(a)},e._createMsalBrowserPairwiseBrokerClient=function(e,t,n,a){var r=this._getMsalBrowserConfiguration(e,t,n,a),o={actAsBroker:!0,preferredInteractionType:i.Y8.Popup},s=new S.E(r,o);return s.initialize().then(function(){return s.initializeBrokering().then(function(){return s})})},e._getMsalBrowserConfiguration=function(t,n,a,i){var r={auth:{authority:t,clientId:n,navigateToLoginRequestUrl:!0,redirectUri:a,supportsNestedAppAuth:i},system:{loadFrameTimeout:1e4,navigateFrameWait:0},cache:{claimsBasedCachingEnabled:!0}};return(0,l.fB)()&&e._isLocalStorageAvailable()&&r.cache&&(r.cache.cacheLocation="localStorage"),b()&&r.system&&(r.system.loggerOptions={loggerCallback:function(e,t,n){console.log("[sp-http][msal-browser.js][LogLevel:".concat(e,"]: ").concat(t))},piiLoggingEnabled:!0,logLevel:D.$.Verbose}),r},e._isLocalStorageAvailable=function(){try{if(localStorage)return localStorage.setItem(e._LOCAL_STORAGE_TEST_STRING,e._LOCAL_STORAGE_TEST_STRING),localStorage.removeItem(e._LOCAL_STORAGE_TEST_STRING),!0}catch(e){}return!1},e._msalBrowserClients=new Map,e._LOCAL_STORAGE_TEST_STRING="lsTest",e._NAA_CLIENT_SUFFIX="naa",e._PAIRWISEBROKER_CLIENT_SUFFIX="pwb",e}(),C=function(){function e(){}return e.initialize=function(){e._invalidSessionIds||(e._invalidSessionIds=e._loadInvalidSessionIdsFromStorage())},e.isSessionIdInvalid=function(t){return-1!==e._invalidSessionIds.indexOf(t)},e.addInvalidSessionId=function(t){var n=e._invalidSessionIds,a=e.isSessionIdInvalid(t);t&&!a&&(n.length>=e._MAX_SIDS&&e._invalidSessionIds.shift(),e._invalidSessionIds.push(t),e.saveInvalidSessionIdsToStorage())},e.saveInvalidSessionIdsToStorage=function(){if(e._invalidSessionIds){var t=JSON.stringify(e._invalidSessionIds);window.localStorage.setItem(e._INVALID_SID_SS_KEY,t)}},e._loadInvalidSessionIdsFromStorage=function(){var t=window.localStorage.getItem(e._INVALID_SID_SS_KEY);if(!t)return new Array;try{return JSON.parse(t)}catch(e){return new Array}},e._INVALID_SID_SS_KEY="spfx.msal.invalidSessionIds",e._MAX_SIDS=5,e}(),O=n(8100),w="spa_refresh_token_exp",E=new Map,A=["user_canceled","user_cancelled"];!function(e){e[e.LOGIN_HINT_CLAIM=0]="LOGIN_HINT_CLAIM",e[e.SESSION_ID=1]="SESSION_ID",e[e.UPN=2]="UPN",e[e.NONE=3]="NONE"}(g||(g={}));var L=function(){function e(e){this._ALLOWED_NETWORK_RETRY_ATTEMPTS=1,this._defaultConfiguration=e,this._redirectManager=new h(this._getAuthority(),this._getClientId(),!0),this._shouldPrintDebugLogs=b(),x.registerMsalBrowserClient(this._getAuthority(),this._getClientId(),this._getRedirectUri(),!!this._defaultConfiguration.isNaaSupported,!!this._defaultConfiguration.isPairwiseBrokerEnabled),C.initialize()}return e.prototype.getToken=function(e,t){var n=t&&"object"==typeof t?(0,a.__assign)({},t):{useCachedToken:t,authenticationScheme:f.l.BEARER};return this.getTokenData(e,n).then(function(e){return e.accessToken})},e.prototype.getTokenData=function(e,t,n){var a=this;void 0===t&&(t=!0),void 0===n&&(n=!1);var i=new I._QosMonitor("MsalBrowserV3TokenProvider.getTokenData");if(!(0,p.KX)()&&this._defaultConfiguration.isAnonymousGuestUser||!(0,p.Ef)()&&this._defaultConfiguration.isEmailAuthenticationGuestUser)throw new Error("Anonymous or Email authenticated Guest User may not request tokens");var r=t&&"object"==typeof t?t:{skipLoggingAndDisableRedirects:n,useCachedToken:t,claims:void 0,authenticationScheme:f.l.BEARER},o=r.skipLoggingAndDisableRedirects,s=void 0!==o&&o,c=r.useCachedToken,d=void 0===c||c,u=r.claims,m=r.scopes,_=r.callersQosName;this._shouldPrintDebugLogs=b();var h={authenticationScheme:r.authenticationScheme,claims:u,scopes:m,loginHintType:g.SESSION_ID,resourceEndpoint:e,resourceRequestMethod:r.resourceRequestMethod,shrClaims:r.shrClaims,shouldNotLogOrRedirect:s,telemetryData:this._generateTelemetryData(e,r.authenticationScheme,_),useCachedToken:d};return this._updatePageEndVisibility(h.telemetryData),(0,l.Z_)()&&r.authenticationScheme===f.l.POP?!E.has(e)||this._isResourceEndpointExpired(e)?this._getShrNonce(h).then(function(e){return i.writeSuccess(h.telemetryData),h.shrNonce=e,a._getTokenDataInternal(h,r)}).catch(function(t){return a._logger("_getShrNonce","Caught an error while fetching server Nonce.",t),"NonceNotSupported"===t.name?(E.set(e,new Date),i.writeUnexpectedFailure(t.errorCode,t,h.telemetryData),r.authenticationScheme=f.l.BEARER,a._getTokenDataInternal(h,r)):Promise.reject(t)}):(r.authenticationScheme=f.l.BEARER,this._getTokenDataInternal(h,r)):this._getTokenDataInternal(h,r)},e.prototype._ensureState=function(){var e=this;if(!(0,p.CA)()){var t=this._getEncryptedAuthorizedResponseToken();if(t.spa_rt){if(this._isRefreshTokenExpirationDateValid())return new I._QosMonitor("MsalBrowserV3TokenProvider.EncryptedAuthorizationResponseAlreadyProcessed").writeSuccess(),Promise.resolve();var n=new I._QosMonitor("MsalBrowserV3TokenProvider.EncryptedAuthorizationResponse"),a={alias:"false",aadSessionId:this._getSessionId(),CorrelationId:s.Guid.newGuid().toString(),isInternal:!0,isPageVisibleStart:"visible"===document.visibilityState,isPageVisibleEnd:!1,redirectUri:this._getRedirectUri(),msalVersion:"3.19.1"},i={claims:void 0,loginHintType:g.SESSION_ID,resourceEndpoint:"",shouldNotLogOrRedirect:!0,telemetryData:a,useCachedToken:!0};return this._ensureMsalClientIsInitialized(i).then(function(){var n={scopes:[],authority:e._getAuthority()},a={refresh_token:t.spa_rt,client_info:t.client_info};return e._msalBrowserClient.getTokenCache().loadExternalTokens(n,a,{})}).then(function(){return n.writeSuccess(),t.spa_refresh_token_exp&&e._setRefreshTokenExpirationDate(t.spa_refresh_token_exp),Promise.resolve()}).catch(function(e){n.writeUnexpectedFailure("FailedToCacheEarToken",e)})}new I._QosMonitor("MsalBrowserV3TokenProvider.EncryptedAuthorizationResponseCookieNotFound").writeUnexpectedFailure()}return this.getTokenData("https://graph.microsoft.com",{isEnsureRequest:!0}).then(function(){return Promise.resolve()})},e.prototype._ensureTelemetry=function(){return!(0,p.sm)()&&window.sessionStorage.getItem(m)&&this._monitorFullPageRedirectReliability(),Promise.resolve()},e.prototype._getEncryptedAuthorizedResponseToken=function(){for(var e={spa_rt:"",client_info:"",oid:"",spa_refresh_token_exp:""},t=0,n=!0,a="";n;){var i="".concat("SPA_RT").concat(t>0?t:""),r=this._getCookieData(i);r.length<4e3&&(n=!1),a+=r,t++}if(a.length>0){var o=window.atob(a);e=JSON.parse(o)}return e},e.prototype._getCookieData=function(e){var t="";if(document.cookie.length>0){var n=document.cookie.indexOf(e+"=");if(n>=0){n+=e.length+1;var a=document.cookie.indexOf(";",n);a<0&&(a=document.cookie.length),t=document.cookie.substring(n,a)}}return t},e.prototype._setRefreshTokenExpirationDate=function(e){try{localStorage.setItem(w,e)}catch(t){sessionStorage.setItem(w,e)}},e.prototype._isRefreshTokenExpirationDateValid=function(){var e,t=!1;try{try{e=localStorage.getItem(w)}catch(t){e=sessionStorage.getItem(w)}e&&Date.parse(e)>Date.now()&&(t=!0)}catch(e){return!1}return t},e.prototype._getShrNonce=function(e){var t=this,n=new I._QosMonitor("MsalBrowserV3TokenProvider.GetShrNonce");return O.L.getNonceManager().getNonceFromResource(e.resourceEndpoint,e.useCachedToken).then(function(a){return t._logger("getNonceFromResource","Successfully got a Server Nonce."),n.writeSuccess(e.telemetryData),a}).catch(function(a){throw t._logger("getNonceFromResource","Caught an error while fetching server Nonce.",a),n.writeUnexpectedFailure(a.errorCode,a,e.telemetryData),a})},e.prototype._getTokenDataInternal=function(e,t,n){var a=this;return void 0===n&&(n=!1),this._ensureMsalClientIsInitialized(e).then(function(){var i,r=!!a._defaultConfiguration.isNaaSupported&&a._defaultConfiguration.servicePrincipalId===c.A.PRE_AUTHORIZED_APP_PRINCIPAL_ID,o=(0,l.cA)()&&s._BrowserUtilities.isMobileWebView()||(0,l._u)()&&s._BrowserUtilities.isMEEBridgeApplicationHosted();i=n?"MsalBrowserV3TokenProvider.GetTokenDataRetry":r?o?"MsalBrowserV3TokenProvider.GetTokenDataNAAMobile":"MsalBrowserV3TokenProvider.GetTokenDataNAA":"MsalBrowserV3TokenProvider.GetTokenData";var u,f=new I._QosMonitor(i);if(a._isCurrentUserLoggedInToMsal()){var m=new I._QosMonitor("MsalBrowserV3TokenProvider.AcquireTokenSilent");a._logger("getTokenData","User is logged in, calling acquireTokenSilent()."),u=a._acquireTokenSilent(e,m)}else{var _=new I._QosMonitor("MsalBrowserV3TokenProvider.SsoSilent");a._logger("getTokenData","No user is logged in, calling ssoSilent()."),u=a._ssoSilent(e,_)}return u.then(function(t){return a._logger("getTokenData","Token retrieved. Exiting."),e.telemetryData.alias=(!!t.fromCache).toString(),f.writeSuccess(e.telemetryData),t}).catch(function(i){var r=!(0,p.rM)();if((0,p.Ac)()||(e.telemetryData.aadCorrelationId=(null==i?void 0:i.correlationId)?i.correlationId:""),a._logger("getTokenData","Caught an error.",i),!(0,p.NI)()&&a._defaultConfiguration.isNaaSupported&&a._isInteractionRequiredError(i))return f.writeExpectedFailure(i.errorCode,i,e.telemetryData),a._acquireTokenPopupNAA(e);if(a._shouldUsePopup()&&a._isInteractionRequiredError(i)){var o=new I._QosMonitor("MsalBrowserV3TokenProvider.Popup"),s=a._acquireTokenPopup(e,o);if(s)return s}var l=a._isErrorEligibleForRedirect(i)&&a._redirectManager.isAllowedToRedirect()&&!e.shouldNotLogOrRedirect;if(l&&!(0,p.Dr)()&&t.isEnsureRequest&&d.T._doesAadErrorCodeExist(i.message,c.A.CONDITIONAL_ACCESS_POLICY_ERRORS)&&(l=!1,new I._QosMonitor("MsalBrowserV3TokenProvider.ConditionalAccessDuringEnsureState").writeUnexpectedFailure(i.errorCode,i,e.telemetryData)),l){if(a._logger("getTokenData","Calling _loginRedirect()"),e.telemetryData.isTriggerFullPageRedirect=!0,f.writeExpectedFailure(i.errorCode,i,e.telemetryData),r&&(i.isExpectedFailure=!0),(0,p.LV)()){var u=new I._QosMonitor("MsalBrowserV3TokenProvider.FullPageRedirect");t.isEnsureRequest?u.writeExpectedFailure("ensureRequest",i,e.telemetryData):u.writeUnexpectedFailure("redirectNotDuringEnsure",i,e.telemetryData)}a._loginRedirect(e)}else if(a._isExpectedFailure(i))f.writeExpectedFailure(i.errorCode,i,e.telemetryData),r&&(i.isExpectedFailure=!0);else if(f.writeUnexpectedFailure(i.errorCode,i,e.telemetryData),r&&(i.isExpectedFailure=!1),a._isMonitorTimeoutFailure(i)){if(!(0,p.tR)()&&!n)return a._getTokenDataInternal(e,t,!0);new I._QosMonitor("MsalBrowserV3TokenProvider.MonitorWindowTimeout").writeUnexpectedFailure(i.errorCode,i,e.telemetryData)}throw a._logger("getTokenData","Throwing the error back to caller. Exiting."),i})})},e.prototype._ensureMsalClientIsInitialized=function(e){var t=this;return new Promise(function(n){t._msalBrowserClient?n():x.getMsalBrowserClient(t._getAuthority(),t._getClientId(),t._getRedirectUri(),!!t._defaultConfiguration.isNaaSupported,!!t._defaultConfiguration.isPairwiseBrokerEnabled).then(function(e){t._msalBrowserClient=e,n()}).catch(function(t){new I._QosMonitor("MsalBrowserV3TokenProvider._ensureMsalClientIsInitialized").writeUnexpectedFailure("msalClientInit",t,e.telemetryData)})})},e.prototype._acquireTokenSilent=function(e,t,n){var a=this;void 0===n&&(n=0);var i,r=e.telemetryData;0===n||(i=new I._QosMonitor("MsalBrowserV3TokenProvider.RetryAcquireTokenSilent"));var o=this._generateSilentRequest(e);return this._logger("_acquireTokenSilent","Calling acquireTokenSilent with parameters:",o),this._msalBrowserClient.acquireTokenSilent(o).then(function(e){return a._logger("_acquireTokenSilent","Successfully got a token."),r.alias=(!!e.fromCache).toString(),t.writeSuccess(r),null==i||i.writeSuccess(r),e}).catch(function(e){throw a._logger("_acquireTokenSilent","Caught an error:",e),(0,p.Ac)()||(r.aadCorrelationId=(null==e?void 0:e.correlationId)?e.correlationId:""),null==i||i.writeUnexpectedFailure(e.errorCode,e,r),a._isExpectedFailure(e)?t.writeExpectedFailure(e.errorCode,e,r):t.writeUnexpectedFailure(e.errorCode,e,r),a._logger("_acquireTokenSilent","Throwing error back to caller."),e})},e.prototype._ssoSilent=function(e,t,n){var a=this;void 0===n&&(n=0);var i,r=e.telemetryData;0===n||(i=new I._QosMonitor("MsalBrowserV3TokenProvider.RetrySsoSilent"));var o=this._generateSsoSilentRequest(e);return this._logger("_ssoSilent","Calling ssoSilent with parameters:",o),this._msalBrowserClient.ssoSilent(o).then(function(e){return a._logger("_ssoSilent","Successfully got a token."),r.alias=(!!e.fromCache).toString(),t.writeSuccess(r),null==i||i.writeSuccess(r),e}).catch(function(s){if(a._logger("_ssoSilent","Caught an error:",s),(0,p.Ac)()||(r.aadCorrelationId=(null==s?void 0:s.correlationId)?s.correlationId:""),null==i||i.writeUnexpectedFailure(s.errorCode,s,r),o.sid&&e.loginHintType===g.SESSION_ID&&d.T._isSessionDoesNotExistError(s.errorMessage,s.errorCode))return C.addInvalidSessionId(o.sid),a._logger("_ssoSilent","Invalid session ID. Retrying with loginHint as UPN."),n++,a._ssoSilent(e,t,n);var c=n<a._ALLOWED_NETWORK_RETRY_ATTEMPTS;if(a._isRetriableNetworkError(s)&&c)return n++,a._logger("_ssoSilent","Retrying."),a._ssoSilent(e,t,n);throw a._isExpectedFailure(s)?t.writeExpectedFailure(s.errorCode,s,r):t.writeUnexpectedFailure(s.errorCode,s,r),a._logger("_ssoSilent","Throwing error back to caller."),s})},e.prototype._loginRedirect=function(e){var t=this,n=e.telemetryData,a=this._generateLoginRedirectRequest(e);return this._logger("_loginRedirect","Calling prepareForRedirect()."),(0,p.sm)()?this._redirectManager.prepareForRedirect():this._redirectManager.prepareForRedirect(e.telemetryData.CorrelationId),C.saveInvalidSessionIdsToStorage(),this._logger("_loginRedirect","Calling loginRedirect."),this._msalBrowserClient.loginRedirect(a).catch(function(e){throw(0,p.Ac)()||(n.aadCorrelationId=(null==e?void 0:e.correlationId)?e.correlationId:""),t._logger("_loginRedirect","Failed to redirect with error:",e),(0,p.wd)()||t._redirectManager.cancelRedirect(),new I._QosMonitor("MsalBrowserV3TokenProvider._loginRedirect").writeUnexpectedFailure(e.errorCode,e,n),e})},e.prototype._acquireTokenPopupNAA=function(e){var t=this,n=new I._QosMonitor("MsalBrowserV3TokenProvider.PopupMonitorNAA"),a=this._generatePopupRequest(e),i=e.resourceEndpoint,r=this._generateTelemetryData(i,e.authenticationScheme);return this._msalBrowserClient.acquireTokenPopup(a).then(function(e){return t._logger("_acquireTokenPopupNAA","Successfully got a token."),r.alias=(!!e.fromCache).toString(),n.writeSuccess(r),e}).catch(function(e){return t._logger("_acquireTokenPopup","Caught an error.",e),(0,p.Ac)()||(r.aadCorrelationId=(null==e?void 0:e.correlationId)?e.correlationId:""),t._isExpectedFailure(e)?n.writeExpectedFailure(e.errorCode,e,r):n.writeUnexpectedFailure(e.errorCode,e,r),Promise.reject(e)})},e.prototype._acquireTokenPopup=function(e,t){var n,a,i=this,r=e.resourceEndpoint,o=(0,p.fM)()?void 0:new Promise(function(e,t){n=e,a=t}),c=function(){o||(0,p.fM)()&&(o=new Promise(function(e,t){n=e,a=t}))};if(s._SPEventManager.instance.raiseEvent(u.Oy._popupEventId,new u.n2(function(e){o||c(),a&&a(e)},c,function(){!o&&(0,p.fM)()&&c();var a=i._generateTelemetryData(r,e.authenticationScheme),s=i._generatePopupRequest(e);i._logger("_acquireTokenPopup","Calling acquireTokenPopup with parameters:",s),n&&n(i._msalBrowserClient.acquireTokenPopup(s).then(function(e){return i._logger("_acquireTokenPopup","Successfully got a token."),a.alias=(!!e.fromCache).toString(),t.writeSuccess(a),e}).catch(function(e){return i._logger("_acquireTokenPopup","Caught an error.",e),(0,p.Ac)()||(a.aadCorrelationId=(null==e?void 0:e.correlationId)?e.correlationId:""),i._isExpectedFailure(e)?t.writeExpectedFailure(e.errorCode,e,a):t.writeUnexpectedFailure(e.errorCode,e,a),Promise.reject(e)}))})),o)return o},e.prototype._generateSilentRequest=function(e){var t=e.resourceEndpoint,n=e.claims,r=e.scopes,o=e.useCachedToken,s=e.telemetryData.CorrelationId,c=(0,a.__assign)((0,a.__assign)({account:this._getCurrentAccount(),authority:this._getAuthority(),correlationId:s,scopes:r||this._getScopes(t)},o||(0,p.tf)()?{}:{cacheLookupPolicy:i.pN.RefreshTokenAndNetwork}),n?{claims:n}:{});return(0,l.Z_)()&&e.authenticationScheme===f.l.POP&&(c.resourceRequestUri=t,c.authenticationScheme=this._getAuthenticationScheme(e.authenticationScheme),e.resourceRequestMethod&&(c.resourceRequestMethod=e.resourceRequestMethod),e.shrClaims&&(c.shrClaims=e.shrClaims),c.shrNonce=e.shrNonce),c},e.prototype._setLoginHint=function(e,t){if(t.loginHintType===g.SESSION_ID){var n=this._getSessionId();n&&!C.isSessionIdInvalid(n)?(e.loginHint=void 0,e.sid=n):t.loginHintType=g.UPN}if(t.loginHintType===g.UPN){var a=this._getUPN();a?(e.loginHint=a,e.sid=void 0):t.loginHintType=g.NONE}t.loginHintType===g.NONE&&(e.loginHint=void 0,e.sid=void 0)},e.prototype._generateSsoSilentRequest=function(e){var t=e.resourceEndpoint,n=e.claims,i=e.telemetryData.CorrelationId,r=e.scopes,o=(0,a.__assign)({authority:this._getAuthority(),correlationId:i,scopes:r||this._getScopes(t)},n?{claims:n}:{});return this._setLoginHint(o,e),(0,l.Z_)()&&e.authenticationScheme===f.l.POP&&(o.resourceRequestUri=t,o.authenticationScheme=this._getAuthenticationScheme(e.authenticationScheme),e.resourceRequestMethod&&(o.resourceRequestMethod=e.resourceRequestMethod),e.shrClaims&&(o.shrClaims=e.shrClaims),o.shrNonce=e.shrNonce),o},e.prototype._generatePopupRequest=function(e){var t=e.resourceEndpoint,n=e.claims,i=e.scopes,r=e.telemetryData.CorrelationId,o=(0,a.__assign)({account:this._getCurrentAccount(),authority:this._getAuthority(),correlationId:r,scopes:i||this._getScopes(t)},n?{claims:n}:{});return this._setLoginHint(o,e),(0,l.Z_)()&&e.authenticationScheme===f.l.POP&&(o.resourceRequestUri=t,o.authenticationScheme=this._getAuthenticationScheme(e.authenticationScheme),e.resourceRequestMethod&&(o.resourceRequestMethod=e.resourceRequestMethod),e.shrClaims&&(o.shrClaims=e.shrClaims),o.shrNonce=e.shrNonce),o},e.prototype._generateTelemetryData=function(e,t,n){var a=this._defaultConfiguration.servicePrincipalId===c.A.PRE_AUTHORIZED_APP_PRINCIPAL_ID,i={alias:"false",aadSessionId:this._getSessionId(),CorrelationId:s.Guid.newGuid().toString(),isInternal:a,isPageVisibleStart:"visible"===document.visibilityState,isPageVisibleEnd:!1,redirectUri:this._getRedirectUri(),msalVersion:"4.2.0",callersQosName:n};return i.isInternal&&(i.name=e),(0,l.Z_)()&&(i.authenticationScheme=t),i},e.prototype._isErrorEligibleForRedirect=function(e){var t=this._isInteractionRequiredError(e),n=s._BrowserDetection.getBrowserInformation().browser===s._Browser.IE;return t&&!n},e.prototype._shouldUsePopup=function(){return!(0,p.TS)()&&!!this._defaultConfiguration.isMsalTokenProviderPopupEnabled},e.prototype._isInteractionRequiredError=function(e){return e instanceof r.EB||d.T._isInteractionRequired(e.message,e.errorCode)||"no_account_error"===e.errorCode},e.prototype._isExpectedFailure=function(e){var t=this._isErrorEligibleForRedirect(e)&&(this._redirectManager.hasRedirectAttemptsLeft()||this._redirectManager.isRedirectInProgress()),n=d.T._doesAadErrorCodeExist(e.message,c.A.EXPECTED_AAD_ERRORS),a=this._isTabStopTest(),i=!(0,p.oo)()&&A.indexOf(e.errorCode)>-1;return t||n||a||i},e.prototype._isMonitorTimeoutFailure=function(e){return e.errorCode===c.A.MONITOR_WINDOW_TIMEOUT},e.prototype._isTabStopTest=function(){return(s._BrowserDetection.getBrowserInformation().userAgent||"").indexOf("TabStop/1.0")>-1},e.prototype._generateLoginRedirectRequest=function(e){var t=e.resourceEndpoint,n=e.telemetryData.CorrelationId,a={authority:this._getAuthority(),correlationId:n,onRedirectNavigate:this._getOnRedirectNavigate(e),redirectUri:this._getRedirectUri(),scopes:this._getScopes(t),state:window.location.href,claims:e.claims};return(0,l.Z_)()&&e.authenticationScheme===f.l.POP&&(a.resourceRequestUri=t,a.authenticationScheme=this._getAuthenticationScheme(e.authenticationScheme),e.resourceRequestMethod&&(a.resourceRequestMethod=e.resourceRequestMethod),e.shrClaims&&(a.shrClaims=e.shrClaims),a.shrNonce=e.shrNonce),a},e.prototype._getOnRedirectNavigate=function(e){var t=this;return function(n){return t._redirectCancelled=!1,s._SPEventManager.instance.raiseEvent(u.Oy._onBeforeRedirectEventId,new u.Pg(n,t._cancelRedirect.bind(t),t._defaultConfiguration)),"true"===window.sessionStorage.getItem("_isRunningTABTest")&&(t._redirectCancelled=!0),t._redirectCancelled?t._redirectManager.cancelRedirect():(0,p.LV)()&&new I._QosMonitor("MsalBrowserV3TokenProvider.FullPageRedirectTriggering",!0,!0).writeUnexpectedFailure("FullPageRedirect",void 0,e.telemetryData),!t._redirectCancelled}},e.prototype._getCurrentAccount=function(){var e=this._defaultConfiguration.userPrincipalName||"",t=this._defaultConfiguration.aadUserId||"",n=this._msalBrowserClient.getAccountByUsername(e),a=this._msalBrowserClient.getAccountByLocalId(t),i=this._msalBrowserClient.getActiveAccount();return n||a?this._logger("_getCurrentAccount","Found an account",{currentAccountByLocalId:a,currentAccountByUsername:n}):this._logger("_getCurrentAccount","No account found"),n||a||i||void 0},e.prototype._cancelRedirect=function(){this._redirectCancelled=!0},e.prototype._isRetriableNetworkError=function(e){return d.T._isTokenRenewalTimeout(null==e?void 0:e.errorCode)},e.prototype._isCurrentUserLoggedInToMsal=function(){return void 0!==this._getCurrentAccount()},e.prototype._getAuthority=function(){return this._defaultConfiguration.aadInstanceUrl+"/"+this._defaultConfiguration.aadTenantId},e.prototype._getUPN=function(){return this._defaultConfiguration.userPrincipalName},e.prototype._getScopes=function(e){return[e+"/.default"]},e.prototype._getSessionId=function(){var e=this._defaultConfiguration.aadSessionId;return!!s.Guid.tryParse(e)||(e=void 0),e?this._logger("_getSessionId","Found session ID",e):this._logger("_getSessionId","No session ID was found"),e},e.prototype._getClientId=function(){return this._defaultConfiguration.servicePrincipalId},e.prototype._getRedirectUri=function(){return this._defaultConfiguration.redirectUri},e.prototype._logger=function(e,t,n){this._shouldPrintDebugLogs&&(console.log("[sp-http][MsalBrowserTokenProvider]["+e+"][1]: "+t),n&&(console.log("[sp-http][MsalBrowserTokenProvider]["+e+"][2] Extra Data: "),console.log(n)))},e.prototype._getAuthenticationScheme=function(e){return e===f.l.BEARER?o.TO.BEARER:o.TO.POP},e.prototype._updatePageEndVisibility=function(e){e&&(e.isPageVisibleEnd="visible"===document.visibilityState)},e.prototype._monitorFullPageRedirectReliability=function(){var e=new I._QosMonitor("MsalBrowserV3TokenProvider.fullPageRedirect"),t=window.sessionStorage.getItem(_)||"",n=window.sessionStorage.getItem(m),a=n?new Date(n):void 0,i=a?Date.now()-a.getTime():0,r={isInternal:!0,alias:"false",timeElapsed:i,CorrelationId:t};a&&i<=1e4?e.writeSuccess(r):e.writeUnexpectedFailure("RedirectOccurredAfterTimeRange",new Error("Redirect occurred outside of time range"),r),window.sessionStorage.removeItem(_),window.sessionStorage.removeItem(m)},e.prototype._isResourceEndpointExpired=function(e){if(E.has(e)){var t=E.get(e);if(void 0!==t){var n=new Date(t);if(n.setDate(n.getDate()+5),new Date>n)return!0}}return!1},e}()}
}]);