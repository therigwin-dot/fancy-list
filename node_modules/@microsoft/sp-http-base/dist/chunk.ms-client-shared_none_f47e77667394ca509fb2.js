"use strict";(self["webpackJsonp_8496636c-2300-4915-abef-20de64c98d8b_1.21.1_"]=self["webpackJsonp_8496636c-2300-4915-abef-20de64c98d8b_1.21.1_"]||[]).push([[389],{3688:(e,t,n)=>{n.r(t),n.d(t,{OAuthUtility:()=>f,OAuthUtilityError:()=>s,OAuthUtilityErrorType:()=>r});var a=n(9676);const i=function(){function e(){}return e.tokenCacheSessionStorageId="tokenCache",e.aboutToExpireIntervalSeconds=600,e.apiUrl="/_api/SP.OAuth.Token/Acquire",e.retries=3,e.retriableErrorCodes=[10006,10008],e.interactionRequiredErrorCodes=[10001,10013],e.unexpectedErrorCodeFormat="Expected error code format is <numericCode>, <exception class name>",e.unexpectedTokenMessageFormat="Your token request succeedeed but the token could not be parsed from the response.This is most probably caused by a change in the server response format",e.npmPackageVersion="0.1.5",e}();var r,o=n(280);!function(e){e[e.unknownError=0]="unknownError",e[e.malformedResponseBody=1]="malformedResponseBody",e[e.serverError=2]="serverError"}(r||(r={}));const s=function(e){function t(n,a){var i=e.call(this,a.message)||this;return i.__proto__=t.prototype,i._type=n,i._httpResponseStatus=a.httpResponseStatus,i._cultureName=a.cultureName,i._message=a.message,i._serverErrorCode=a.serverErrorCode,i._correlationId=a.correlationId,i._redirectUrl=a.redirectUrl,i}return(0,o.__extends)(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"serverErrorCode",{get:function(){if(this.type!==r.serverError)throw new Error("ServerErrorCode can only be obtained for errors of type serverError");return this._serverErrorCode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpResponseStatus",{get:function(){return this._httpResponseStatus},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cultureName",{get:function(){return this._cultureName},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"correlationId",{get:function(){return this._correlationId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"redirectUrl",{get:function(){return this._redirectUrl},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isExpected",{get:function(){return this._isExpected},set:function(e){this._isExpected=e},enumerable:!1,configurable:!0}),t}(Error);var c,d;!function(e){e.new="new",e.inProgress="inProgress",e.done="done"}(c||(c={})),function(e){e.success="success",e.canceled="canceled"}(d||(d={}));var l="oAuthLastInteractionHandledInfo",u=function(){function e(){var t=this;this._handleInteractionCoolDownPeriod=864e5,this.handleInteractionRequiredError=function(n,a){var i,r,s,l,u,f,p,m,_=null===(i=a.qosMonitor)||void 0===i?void 0:i.call(a);try{if(t._oAuthError=n,t._interactionHandledInfo=e._getInteractionHandledInfo(),t._errorInfoKey="".concat(n.serverErrorCode),t._lastInteraction=null===(s=null===(r=t._interactionHandledInfo)||void 0===r?void 0:r.errorInfo)||void 0===s?void 0:s[t._errorInfoKey],t._context=a,t._coolDownPeriod=t._isHandleInteractionUnderCoolDownPeriod(),t._coolDownPeriod&&(null===(l=t._lastInteraction)||void 0===l?void 0:l.status)===d.canceled)return}catch(e){return void(null==_||_.writeUnexpectedFailure("initializationFailure",e,n))}try{if(!t._oAuthError.redirectUrl)return void(null==_||_.writeUnexpectedFailure("NoRedirectUrl",t._oAuthError,t._context));if(t._coolDownPeriod)return void(null==_||_.writeExpectedFailure("PreviouslyHandled",t._oAuthError,(0,o.__assign)((0,o.__assign)({},t._interactionHandledInfo),{handleInteractionRequired:t._context.handleInteractionRequired})));"redirect"===(null===(u=t._context)||void 0===u?void 0:u.handleInteractionRequired)?(t._onInteractionRequiredHandled(c.done,d.success),null==_||_.writeSuccess(t._context),window.location.href=t._oAuthError.redirectUrl):(t._setStatusToInProgress(),null===(p=null===(f=t._context.interactionRequiredPopup)||void 0===f?void 0:f.showInteractionRequiredDialog)||void 0===p||p.call(f,t._confirmAction,t._onDismiss),null===(m=t._context.logger)||void 0===m||m.logEvent("OAuth.InteractionRequired.Popup.Shown"),null==_||_.writeSuccess(t._context))}catch(e){null==_||_.writeUnexpectedFailure("Failed",e,{handleInteractionRequired:t._context.handleInteractionRequired,oAuthError:JSON.stringify(t._oAuthError)})}},this._setStatusToInProgress=function(){var n=t._interactionHandledInfo||{};n.requestHandlingStatus=c.inProgress,e._updateCache(n)},this._onInteractionRequiredHandled=function(n,a){var i,r=t._interactionHandledInfo||{};r.errorInfo=(0,o.__assign)((0,o.__assign)({},r.errorInfo),((i={})[t._errorInfoKey]={handledAtTime:(new Date).toString(),errorCode:"".concat(t._oAuthError.serverErrorCode),message:t._oAuthError.message,status:a},i)),e._updateCache((0,o.__assign)((0,o.__assign)({},r),{requestHandlingStatus:n}))},this._onDismiss=function(){var e;null===(e=t._context.logger)||void 0===e||e.logEvent("OAuth.InteractionRequired.Popup.Dismiss"),t._onInteractionRequiredHandled(c.done,d.canceled)},this._confirmAction=function(){var e;null===(e=t._context.logger)||void 0===e||e.logEvent("OAuth.InteractionRequired.Popup.Refresh"),t._onInteractionRequiredHandled(c.done,d.success),window.location.href=t._oAuthError.redirectUrl},this._isHandleInteractionUnderCoolDownPeriod=function(){if(t._lastInteraction){var e=new Date,n=new Date(t._lastInteraction.handledAtTime);if(e.getTime()-n.getTime()<t._handleInteractionCoolDownPeriod)return!0}return!1}}return e.init=function(){var e=this._getInteractionHandledInfo();(null==e?void 0:e.requestHandlingStatus)===c.inProgress&&(e.requestHandlingStatus=c.new,this._updateCache(e))},e.canHandleInteractionRequiredError=function(e,t){var n=-1!==i.interactionRequiredErrorCodes.indexOf(e)&&!!(null==t?void 0:t.handleInteractionRequired);return this._isMarkExpectedWhenInteractionInProgressKillSwitchEnabled()?n&&this.isHandleInteractionNotInProgress():n},e.isHandleInteractionNotInProgress=function(){var e;return!(e=this._getInteractionHandledInfo())||e.requestHandlingStatus!==c.inProgress},e._isMarkExpectedWhenInteractionInProgressKillSwitchEnabled=function(){return a._SPKillSwitch.isActivated("ca4d45d7-d312-44fa-b65e-9ca1b9653c92")},e._updateCache=function(e){window.sessionStorage.setItem(l,JSON.stringify(e))},e._getInteractionHandledInfo=function(){var e=window.sessionStorage.getItem(l);if(e)return JSON.parse(e)},e}();u.init();const f=function(){function e(e){this._context=e,this._dispose=this._dispose.bind(this),window.addEventListener("unload",this._dispose)}return e._getCorrelationId=function(e){return e.headers.get("sprequestguid")},e._extractRealError=function(e){return e.hasOwnProperty("error")?e.error:e},e.prototype.getOAuthToken=function(e,t,n,a){var r=this,o=this._getCacheKey(e,n),s=this._getCachedTokenData(o);return s&&!this._isExpiring(s)?Promise.resolve({token:s.accessToken,isGuest:!1,expirationTimeMs:s.expiresOn,_correlationId:s.correlationId}):this._retriableFetchWithDigest(e,i.retries,t,n,a).then(function(e){return r._storeTokenData(o,e),{token:e.accessToken,isGuest:!1,expirationTimeMs:e.expiresOn,_correlationId:e.correlationId}})},e.prototype.clearCachedToken=function(e,t){var n=this._getCacheKey(e,t);window.sessionStorage.removeItem(n);var a=this._resourceKeys.indexOf(n);!isNaN(a)&&a>-1&&this._resourceKeys.splice(a)},Object.defineProperty(e.prototype,"_resourceKeys",{get:function(){return this._keysToDispose||(this._keysToDispose=new Array),this._keysToDispose},enumerable:!1,configurable:!0}),e.prototype._retriableFetchWithDigest=function(t,n,i,o,c){var d,l=this,f=this._context.qosMonitor();return this._context.fetchWithDigest(this._buildTokenRequest(t,i,o)).then(function(p){if(d={CorrelationId:e._getCorrelationId(p),resource:t},200!==p.status){l._context.logger.logError("fetchWithDigest failed. Server responded with "+p.statusText);var m=new s(r.unknownError,{httpResponseStatus:p.status,message:p.statusText,correlationId:e._getCorrelationId(p)});return a._SPKillSwitch.isActivated("13621315-ff1d-45a5-a115-c607c98657a4")||403!==p.status?400!==p.status?(f.writeUnexpectedFailure("UnknownError",m,d),Promise.reject(m)):p.json().then(function(a){var r=e._extractRealError(a),s=l._getErrorCodeFromResponseCode(r);if(u.canHandleInteractionRequiredError(s,c)){var p=l._buildErrorFromResponse(r);return(l._isMarkExpectedWhenInteractionInProgressKillSwitchEnabled()||u.isHandleInteractionNotInProgress())&&(new u).handleInteractionRequiredError(p,c),f.writeExpectedFailure("interactionRequired",p,d),p.isExpected=!0,Promise.reject(p)}return l._isRetriableError(s)&&0!==n?(l._context.logger.logError("fetchWithDigest failed. Retrying. Retries left: "+n),l._retriableFetchWithDigest(t,n-1,i,o,c)):(p=l._buildErrorFromResponse(r),f.writeUnexpectedFailure("SharepointServerError",p,d),Promise.reject(p))}):(f.writeExpectedFailure("Unauthorized",m,d),Promise.reject(m))}return l._instrumentedParseResponseData(p,f,d)})},e.prototype._isMarkExpectedWhenInteractionInProgressKillSwitchEnabled=function(){return a._SPKillSwitch.isActivated("ca4d45d7-d312-44fa-b65e-9ca1b9653c92")},e.prototype._getCachedTokenData=function(e){return JSON.parse(window.sessionStorage.getItem(e))},e.prototype._storeTokenData=function(e,t){try{window.sessionStorage.setItem(e,JSON.stringify(t))}catch(e){if(a._SPKillSwitch.isActivated("31ae2278-3627-43db-9bac-cee9cc5cfc3b")||!this._isQuotaExceededError(e))throw e;this._context.qosMonitor().writeExpectedFailure("StorageQuotaExceededError",e)}},e.prototype._isQuotaExceededError=function(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&window.sessionStorage&&0!==window.sessionStorage.length},e.prototype._getCacheKey=function(e,t){var n=a._SPKillSwitch.isActivated("034fd019-f717-4e6f-be7a-2d878a7a1c1d")?["sp-client-shared",i.npmPackageVersion,"OAuthUtility",e].join(";"):["sp-client-shared",i.npmPackageVersion,"OAuthUtility",e,t].join(";");return-1===this._resourceKeys.indexOf(n)&&this._resourceKeys.push(n),n},e.prototype._isExpiring=function(e){return e.expiresOn-Date.now()/1e3<i.aboutToExpireIntervalSeconds},e.prototype._isRetriableError=function(e){return-1!==i.retriableErrorCodes.indexOf(e)},e.prototype._buildTokenRequest=function(e,t,n){var a=new Headers;a.append("Content-Type","application/json; charset=utf-8"),a.append("Odata-Version","4.0"),a.append("Accept","application/json;odata.metadata=minimal");var r={method:"POST",headers:a,body:JSON.stringify(this._buildRequestBody(e,n))},o=t;return o&&o.lastIndexOf("/")===o.length-1&&(o=o.substr(0,o.length-1)),new Request(o+i.apiUrl,r)},e.prototype._buildRequestBody=function(e,t){return a._SPKillSwitch.isActivated("d0b667ec-278c-4551-bada-5c5e34f466b1")?{resource:e}:{resource:e,tokenType:t}},e.prototype._buildErrorFromResponse=function(e){var t,n,a=this._getErrorCodeFromResponseCode(e);if(void 0===a)return new s(r.malformedResponseBody,{httpResponseStatus:400,message:i.unexpectedErrorCodeFormat,correlationId:e.correlationId});e.message&&("string"==typeof e.message?t=e.message:(t=e.message.value,n=e.message.lang));var o="error.redirectUrl";return new s(r.serverError,{httpResponseStatus:400,message:t,cultureName:n,serverErrorCode:a,correlationId:e.correlationId,redirectUrl:e[o]||e["@".concat(o)]})},e.prototype._getErrorCodeFromResponseCode=function(e){var t=e.code,n=Number(t);if(isNaN(n)&&"string"==typeof e.message){var a=t.indexOf(",");-1!==a&&(n=Number(t.substr(0,a)))}return n},e.prototype._instrumentedParseResponseData=function(t,n,a){return Promise.resolve().then(function(){return t.ok?t.json():Promise.reject(new Error(t.statusText))}).then(function(i){return n.writeSuccess(a),{accessToken:i.access_token,correlationId:e._getCorrelationId(t),expiresOn:Number(i.expires_on),notBefore:Number(i.not_before),resource:i.resource,tokenType:i.token_type}}).catch(function(o){throw n.writeUnexpectedFailure("ResponseParseError",o,a),new s(r.malformedResponseBody,{httpResponseStatus:t.status,message:i.unexpectedTokenMessageFormat,correlationId:e._getCorrelationId(t)})})},e.prototype._dispose=function(e){window.removeEventListener("unload",this._dispose);for(var t=0,n=this._resourceKeys;t<n.length;t++){var a=n[t];window.sessionStorage.removeItem(a)}},e}()}
}]);